<!DOCTYPE html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1">
    <link rel="canonical" href="https://blog.dgraph.io/post/migrating-from-sql-to-dgraph/" />


    <link rel="apple-touch-icon" sizes="57x57" href="https://dgraph.io/assets/images/favicons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="https://dgraph.io/assets/images/favicons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://dgraph.io/assets/images/favicons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://dgraph.io/assets/images/favicons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://dgraph.io/assets/images/favicons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://dgraph.io/assets/images/favicons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://dgraph.io/assets/images/favicons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://dgraph.io/assets/images/favicons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://dgraph.io/assets/images/favicons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="https://dgraph.io/assets/images/favicons/android-icon-192x192.png">
    <link rel="manifest" href="https://dgraph.io/assets/images/favicons/manifest.json">
    <link rel="icon" type="image/png" sizes="32x32" href="https://dgraph.io/assets/images/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="https://dgraph.io/assets/images/favicons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://dgraph.io/assets/images/faviconsfavicon-16x16.png">
    <link rel="shortcut icon" href="https://dgraph.io/assets/images/favicons/favicon.ico">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="https://dgraph.io/assets/images/faviconsms-icon-144x144.png">
    <meta name="msapplication-config" content="https://dgraph.io/assets/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://blog.dgraph.io//index.xml">
  
    <title>Migrating data from SQL to Dgraph - Dgraph Blog</title>
    <meta property='og:title' content="Migrating data from SQL to Dgraph - Dgraph Blog">
    <meta property="og:type" content="article">
  

  <meta property="og:url" content="https://blog.dgraph.io/post/migrating-from-sql-to-dgraph/">
  
  <meta property="og:image" content="https://blog.dgraph.io//images/migration.jpg">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js" integrity="sha256-0rguYS0qgS6L4qVzANq4kjxPLtvnp5nn2nB5G1lWRv4=" crossorigin="anonymous"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/styles/default.min.css" rel="stylesheet" integrity="sha256-Zd1icfZ72UBmsId/mUcagrmN7IN5Qkrvh75ICHIQVTk=" crossorigin="anonymous" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js" integrity="sha256-sNPiigbfSkqUzMc5rgrdztLnneCMAp6W9wetJUZu9Zw=" crossorigin="anonymous"></script>

  <link
    href='https://blog.dgraph.io//css/runnable.css?7bbf71b4888bc97241e85bc7326a12fe'
    rel="stylesheet"
  />
  <link
    href='https://blog.dgraph.io//css/runnable-custom.css?74110b504a7b8a6e92a95279cfa96032'
    rel="stylesheet"
  />

  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Mono:wght@400;500&display=swap" />

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />

  <link href="https://dgraph.io/assets/css/style.min.css?06042020-8" rel="stylesheet" type="text/css" />

  <link href="https://dgraph.io/assets/css/font-awesome/css/all.css" rel="stylesheet"/>

  <script
    src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/codemirror.js" integrity="sha256-x3BtPVERvw1ozPlwivuFLZoViFCeAAs1Gt6SxEedmo8=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/codemirror.css" integrity="sha256-7sZe9dsqyNZC9Mk+WPRB7nVvPPPXyorzm2QKqlgXC4k=" crossorigin="anonymous" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/addon/edit/closebrackets.min.js" integrity="sha256-qhu2a7DSpQaammMaLw1iruxBpxmgdw8mdQaQWQUokcY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/mode/javascript/javascript.min.js" integrity="sha256-7Bdg/UdDMmHDPafpQDYZNPCEbnRP7eAvu+2hEoqRCXs=" crossorigin="anonymous"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Merriweather+Sans:ital@1&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/algoliasearch@3/dist/algoliasearch.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.0.0/dist/instantsearch.production.min.js" integrity="sha256-6S7q0JJs/Kx4kb/fv0oMjS855QTz5Rc2hh9AkIUjUsk=" crossorigin="anonymous"></script>
  <script src="https://blog.dgraph.io//js/search.js?04292020"></script>

  
  
    
      <meta name="twitter:card" content="summary_large_image"/>
      <meta name="twitter:image" content="https://blog.dgraph.io//images/migration.jpg"/>
    
  

  <meta name="twitter:title" content="Migrating data from SQL to Dgraph"/>
  <meta name="twitter:description" content="Dgraph is rapidly gaining reputation as an easy to use database to build apps upon. Many new users of Dgraph have existing relational databases that they want to migrate from."/>
  <meta name="twitter:site" content="@dgraphlabs"/>

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-666192333"></script>
  <script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'AW-666192333');</script>
</head>


<body class="blog-single has-lightning" data-gr-c-s-loaded="true">

    <header id="page-header" class="page-header">
	<div class="page-logo">
		<a href="https://dgraph.io/">
			<img src="https://dgraph.io/assets/images/logo.svg">
		</a>
	</div>
	<nav class="page-nav">
    <ul>
        <li>
            <div data-label="Products">
                <span>Products</span>
            </div>
            <ul>
                <li>
                    <a href="https://dgraph.io/graphql" data-label="GraphQL">
                        <span>GraphQL</span>
                    </a>
                </li>
                <li>
                    <a href="https://dgraph.io/enterprise" data-label="Enterprise">
                        <span>Enterprise</span>
                    </a>
                </li>
                <li>
                    <a href="https://dgraph.io/downloads" data-label="Downloads">
                        <span>Downloads</span>
                    </a>
                </li>
            </ul>
        </li>
        <li>
            <div data-label="Learn" class="is-active">
                <span>Learn</span>
            </div>
            <ul>
                <li>
                    <a href="https://dgraph.io/blog" data-label="Blog">
                        <span>Blog</span>
                    </a>
                </li>
                <li>
                    <a href="https://tour.dgraph.io" target="_blank" data-label="Interactive Tour">
                        <span>Interactive Tour</span>
                    </a>
                </li>
                <li>
                    <a href="https://discuss.dgraph.io" target="_blank" data-label="Forum">
                        <span>Forum</span>
                    </a>
                </li>
                <li>
                    <a href="https://slack.dgraph.io" target="_blank" data-label="Slack">
                        <span>Slack</span>
                    </a>
                </li>
            </ul>
        </li>
        <li>
            <div data-label="Docs"><span>Docs</span></div>
            <ul>
                <li>
                    <a href="https://docs.dgraph.io" target="_blank" data-label="Dgraph Docs">
                        <span>Dgraph Docs</span>
                    </a>
                </li>
                <li>
                    <a href="https://graphql.dgraph.io/docs/" target="_blank" data-label="GraphQL Docs">
                        <span>GraphQL Docs</span>
                    </a>
                </li>
            </ul>
        </li>
        <li>
            <div data-label="Company"><span>Company</span></div>
            <ul>
                <li>
                    <a href="https://dgraph.io/about" data-label="Team">
                        <span>Team</span>
                    </a>
                </li>
                <li>
                    <a href="https://dgraph.io/careers" data-label="Careers">
                        <span>Careers</span>
                    </a>
                </li>
                <li>
                    <a href="https://dgraph.io/contact" data-label="Contact">
                        <span>Contact</span>
                    </a>
                </li>
                <li>
                    <a href="https://dgraph.io/conduct" data-label="Conduct">
                        <span>Conduct</span>
                    </a>
                </li>
            </ul>
        </li>
    </ul>
</nav>

	<div class="page-cta">
    <ul>
        <li class="hide-tablet">
            <a href="https://dgraph.io/contact" title="Contact">Contact</a>
        </li>
        <li>
            <a href="https://dgraph.io/downloads" title="Download" class="button button--secondary">
                <span>Download</span>
                <i class="fas fa-arrow-right"></i>
            </a>
        </li>
    </ul>
</div>

</header>




    <section class="page-body">
        <div class="page-body__content">
            <div class="container">

                <div class="page-search">
	<div class="page-search__toggle" onClick="toggleVisibility()">
		<i class="fas fa-search"></i>
		<i class="fas fa-times"></i>
	</div>
</div>

          

            <div class="row">

                <div class="col-12 col-md-8">
                    <div class="page-body__content post">

                        <div class="post__meta">

                            <div class="post__date">

    
        Thu, May 30, 2019
    
    
</div>


                            <div class="post__share">
                                
                                    <a href="https://twitter.com/share?text=Migrating%20data%20from%20SQL%20to%20Dgraph&amp;url=https%3a%2f%2fblog.dgraph.io%2fpost%2fmigrating-from-sql-to-dgraph%2f&amp;via=dgraphlabs" target="_blank">
                                        <i class="fab fa-twitter"></i>
                                    </a>
                                
                            </div>

                        </div>

                        <div class="post__cover">

                            <img src="https://blog.dgraph.io//images/migration.jpg">

                            <div class="post__header">

                                <h1 class="post__title">
                                    Migrating data from SQL to Dgraph
                                </h1>

                                
<div class="post__byline">

    
            by <a href="https://blog.dgraph.io/authors/lucas/">Lucas Wang</a>
        
    

</div>



                            </div>

                        </div>

                        <div class="post__content inner-content">
                            

<p>Dgraph is rapidly gaining reputation as an easy to use database to build apps upon. Many new users
of Dgraph have existing relational databases that they want to migrate from. In particular, we get
asked a lot about how to migrate data from MySQL to Dgraph.  In this article, we present a tool that
makes this migration really easy: all a user needs to do is write a small 3 lines configuration file
and type in 2 commands. In essence, this tool bridges one of the best
technologies of the 20th century with one of the best ones of the 21st (if you ask us).</p>

<h3 id="two-ways-of-understanding-the-universe">Two ways of understanding the universe</h3>

<p>Before we dive into the details, let&rsquo;s quickly glance over the data models of SQL databases and
Dgraph.  Real life objects have certain attributes: a person has a name, age, and date of birth; a
movie has a name, release date, and genre. SQL databases represent all the attributes of an object
by storing them into a single row in a table. Dgraph, on the other hand, represents these attributes
as edges around a node.</p>

<p>Both systems work equally well if we stop here and consider attributes of objects as the only type
of relationships in the universe.
However, the real universe is more complex than that. The 2nd type of relationship is <em>between
objects</em>.</p>

<p>As a concrete example, an actor is a person that has starred in a number of movies; a movie has one
or more directors, one or more writers, and a generally larger number of actors. In order to logically
link a concept (e.g. a movie) with another (e.g. an actor), a SQL database would normally have
separate tables to represent the relationships. Thus, finding the names of the people that starred in
a given movie requires:</p>

<ol>
<li>locating the movie identifier <code>movie_id</code> by searching for its name in the <code>movie</code> table,</li>
<li>finding the identifiers of the people who starred in that movie <code>person_id</code> from a second <code>acting</code> table, and finally</li>
<li>finding the rows in the <code>people</code> table with the <code>people_id</code>s above and extracting the values in the <code>name</code> column.</li>
</ol>

<p>If that seems already cumbersome, you might now want to consider how much more difficult it can get
for recursive relationships. Imagine there is a <code>people</code> table, and a <code>children</code> table mapping each
<code>person_id</code> to the <code>person_id</code>s of their children. The logic to find all the descendants of a person
with SQL is not trivial and requires a bunch of back and forth interactions between the application and the
database.</p>

<p>Graph Databases come to rescue in situations where SQL would have needed many nested join
operations: in Dgraph, inter-object relationships are represented by <em>edges</em> and edge traversal from
one node to another is supported as a first-class operation. <strong>This seemingly simple difference
makes an entirely new class of operations possible</strong>. Finding all people who are related to a movie
regardless of how they are related (using the <code>expand(_all_)</code> operation), finding all of a person&rsquo;s
descendants regardless of how many generations they are apart (using the <code>@recurse</code> directive), finding the
shortest connection path between two people in a social network (using the <code>shortest</code> function),
etc. The possibilities are limitless.</p>

<h3 id="meet-the-sql-to-dgraph-migration-tool">Meet the SQL to Dgraph migration tool</h3>

<p>If you feel Dgraph is the right fit for your use case, let&rsquo;s dive a little deeper and see how the
migration tool works by studying an example. Below, you can see a <em>simplified</em> version of the
database schema supporting StackOverflow:</p>

<pre><code class="language-SQL">create table users (
	Id int,
	DisplayName varchar(200),
	PRIMARY KEY (Id)
);

create table posts (
	Id                    int,
	AcceptedAnswerId      int NULL,
	Body                  text,
	OwnerUserId           int NULL,
	LastEditorUserId      int NULL,
	Title                 varchar(1000),
	PRIMARY KEY (Id),
	FOREIGN KEY (OwnerUserId) REFERENCES users (Id),
	FOREIGN KEY (LastEditorUserId) REFERENCES users (Id),
	FOREIGN KEY (AcceptedAnswerId) REFERENCES posts (Id)
);

create table comments (
	Id           int,
	PostId       int,
	Text         varchar(1000),
	UserId       int,
	PRIMARY KEY (Id),
	FOREIGN KEY (PostId) REFERENCES posts (Id),
	FOREIGN KEY (UserId) REFERENCES users (Id)
);


create table votes(
	Id           int,
	PostId       int,
	CreationDate varchar(100),
	PRIMARY KEY (Id),
	FOREIGN KEY (PostId) references posts (Id)
);

</code></pre>

<p>Each of the four tables stores objects that have their own attribute(s):</p>

<ul>
<li>A user in <code>users</code> has a <code>DisplayName</code>;</li>
<li>A post in <code>posts</code> has a <code>Title</code> and a <code>Body</code>;</li>
<li>A comment in <code>comments</code> has some <code>Text</code>;</li>
<li>And a vote in <code>votes</code> has its <code>CreationDate</code>.</li>
</ul>

<p>Besides the basic attributes, the objects are also interconnected:</p>

<ul>
<li>A post in <code>posts</code> has an owner and hence a column <code>OwnerUserId</code> referencing a row in the <code>users</code> table.</li>
<li>A comment belongs to a post and hence the <code>comments</code> table has a <code>PostId</code> column referencing
a row in the <code>posts</code> table.</li>
</ul>

<p>To illustrate the migration process, we&rsquo;ve selected some sample rows from these tables. We will walk
through each table, and explain how they can be converted into <a href="https://www.w3.org/TR/n-quads/#n-quads-language">N-Quad</a> entries. The RDF
N-Quad format is one of the formats that can be used for importing data into Dgraph (the other
accepted format is <a href="https://docs.dgraph.io/master/mutations/#json-mutation-format">JSON</a>.)</p>

<pre><code class="language-markdown">
# users

| Id    | DisplayName       |
|-------|-------------------|
|    -1 | NULL              |
|    14 | Jimmy Hoffa       |
|    15 | Mooseman          |
|  2089 | MrPhooky          |
| 12370 | Paul Wesselkamper |

# posts

| Id    | AcceptedAnswerId | Body      | OwnerUserId | LastEditorUserId | Title     |
|-------|------------------|-----------|-------------|------------------|-----------|
|     9 |            11075 | &lt;p&gt;I try  |          14 |             2089 | How can.. |
| 11075 |             NULL | &lt;p&gt;When I |       12370 |               -1 |           |

# comments

| Id | PostId | Text                                  | UserId |
|----|--------|---------------------------------------|--------|
|  4 |      9 | Of what fabric are the blankets made? |     15 |

# votes

| Id | PostId | CreationDate            |
|----|--------|-------------------------|
| 10 |      9 | 2014-12-09T00:00:00.000 |

</code></pre>

<h3 id="converting-sql-rows-to-rdf-n-quad-entries">Converting SQL rows to RDF N-Quad entries</h3>

<p>N-Quad entries have the format <code>&lt;subject&gt; &lt;predicate&gt; &lt;object&gt; .</code>, so the single row in the <code>comments</code>
table is converted into the following N-Quad entries:</p>

<pre><code class="language-RDF">_:comments.4 &lt;comments.Id&gt; &quot;4&quot; .
_:comments.4 &lt;comments.Text&gt; &quot;Of what fabric are the blankets made?&quot; .
</code></pre>

<p>JSON equivalent (for reference):</p>

<pre><code class="language-json">{
  &quot;uid&quot;: &quot;_:comments.4&quot;,
  &quot;comments.Id&quot;: 4,
  &quot;comments.Text&quot;: &quot;Of what fabric are the blankets made?&quot;,
}
</code></pre>

<p>Take the first entry <code>_:comments.4 &lt;comments.Id&gt; &quot;4&quot; .</code> as an example:</p>

<ul>
<li><code>_:comments.4</code> is the subject,</li>
<li><code>comments.Id</code> is the predicate,</li>
<li><code>&quot;4&quot;</code> is the object, and finally</li>
<li><code>.</code> is the terminal symbol of each N-Quad statement.</li>
</ul>

<p>In Dgraph, a subject that begins with <code>_:</code> is called a <em>blank node label</em>, and it represents an object that is still to be created.</p>

<p>Thus the two N-Quad entries tell Dgraph that</p>

<ol>
<li>a new object needs to be created for the comment,</li>
<li>the new object has two attributes <code>comments.Id</code> and <code>comments.Text</code>, whose values are <code>&quot;4&quot;</code>, and <code>&quot;Of what...&quot;</code> respectively.</li>
</ol>

<p>Notice that the blank node label for a given object must be <em>unique</em> across all the generated N-Quad
entries. To ensure uniqueness, we leverage the fact that the values in the primary key columns of a table
are unique so we construct the blank node labels by appending the primary key values after the table
name. The row in the <code>comments</code> table whose primary key is 4 has the blank node label
<code>_:comments_4</code>. However some SQL tables do not have any primary keys. To solve the problem, we would
maintain a counter to generate unique labels for each row in such tables.</p>

<p>Another interesting design decision is that we dropped the values in the <code>PostId</code> and <code>UserId</code> columns, because they should be represented
using edges in Dgraph. We will explain this in more details a little later.</p>

<p>Going back to the four N-Quad entries, it demonstrates the first and second rule for the conversion:</p>

<ul>
<li><p>(1) To generate unique blank node labels, the values in the primary key columns are appended to table names if the table has a primary key; otherwise an increasing counter will be used.</p></li>

<li><p>(2) Each SQL table cell except those in foreign key columns is stored under a predicate name, which is constructed by concatenating the table name and the corresponding column name.</p></li>
</ul>

<p>Similarly the 3 other tables &ldquo;posts&rdquo;, &ldquo;users&rdquo;, and &ldquo;votes&rdquo; can be converted by following the two rules:</p>

<pre><code class="language-RDF">_:posts.9       &lt;posts.Body&gt;                &quot;&lt;p&gt;I try to use...&quot; .
_:posts.9       &lt;posts.Id&gt;                  &quot;9&quot; .
_:posts.9       &lt;posts.Title&gt;               &quot;How can I keep 2 blankets together on a bed?&quot; .
_:posts.11075   &lt;posts.Body&gt;                &quot;&lt;p&gt;When I was in...&quot; .
_:posts.11075   &lt;posts.Id&gt;                  &quot;11075&quot; .
_:posts.11075   &lt;posts.Title&gt;               &quot;&quot; .
_:users.-1      &lt;users.DisplayName&gt;         &quot;&quot; .
_:users.-1      &lt;users.Id&gt;                  &quot;-1&quot; .
_:users.14      &lt;users.DisplayName&gt;         &quot;Jimmy Hoffa&quot; .
_:users.14      &lt;users.Id&gt;                  &quot;14&quot; .
_:users.15      &lt;users.DisplayName&gt;         &quot;Mooseman&quot; .
_:users.15      &lt;users.Id&gt;                  &quot;15&quot; .
_:users.2089    &lt;users.DisplayName&gt;         &quot;MrPhooky&quot; .
_:users.2089    &lt;users.Id&gt;                  &quot;2089&quot; .
_:users.12370   &lt;users.DisplayName&gt;         &quot;Paul Wesselkamper&quot; .
_:users.12370   &lt;users.Id&gt;                  &quot;12370&quot; .
_:votes.10      &lt;votes.CreationDate&gt;        &quot;2014-12-09T00:00:00.000&quot; .
_:votes.10      &lt;votes.Id&gt;                  &quot;10&quot; .
</code></pre>

<p><em>Note</em>: the column formatting was added for your reading, the migration tool would not add the extra whitespaces.</p>

<p>Besides the basic attributes, we also need N-Quad entries to represent the inter-object relationships.
Consider how we converted the <code>PostId</code> and <code>UserId</code> foreign keys in the <code>comments</code> table:</p>

<pre><code class="language-RDF">_:comments.4    &lt;comments.PostId&gt;          _:posts.9 .
_:comments.4    &lt;comments.UserId&gt;          _:users.15 .
</code></pre>

<p>Taking the first N-Quad entry <code>_:comments.4 &lt;comments.PostId&gt; _:posts.9 .</code> as an example.  The
subject is a blank node <code>_:comments.4</code>. The predicate <code>comments.PostId</code> is again the table name concatenated with the
column name. The object <code>_:posts.9</code> is different from a plain attribute value &ndash; it is the
blank node label of a row in the <code>posts</code> table, and derived by looking up the value <code>9</code> in the <code>posts</code> table.</p>

<p>From these entries come our 3rd rule of conversion:</p>

<ul>
<li>(3) Inter-object relationships are derived by following foreign key constraints, where the blank
node labels in the N-Quad objects are calculated through lookups in the target table.</li>
</ul>

<p>Following this rule, we can establish relationships between posts and users, between posts and posts, and between votes and posts:</p>

<pre><code class="language-RDF">_:posts.9 &lt;posts.AcceptedAnswerId&gt; _:posts.11075 .
_:posts.9 &lt;posts.OwnerUserId&gt; _:users.14 .
_:posts.9 &lt;posts.LastEditorUserId&gt; _:users.2089 .
_:votes.10 &lt;votes.PostId&gt; _:posts.9 .
</code></pre>

<h4 id="deriving-a-dgraph-schema-from-sql">Deriving a Dgraph schema from SQL</h4>

<p>Besides converting the data, the migration tool also needs to derive the schema of each predicate.
We have two simple rules for converting the schema:</p>

<ul>
<li>(1) For plain attributes, there is usually a one-to-one mapping between a SQL data type and the
Dgraph datatype. For instance, the <code>Body</code> column in the <code>posts</code> table is of type <code>text</code>,
and hence, the predicate <code>posts.Id</code> is of type <code>string</code>:
<code>posts.Body: string .</code></li>
<li>(2) The predicates representing inter-object relationships, e.g. <code>posts.OwnerUserId.</code>, simply have the type
<code>[uid]</code>, meaning following the predicate leads us to a set of other objects.</li>
</ul>

<p>These two rules give us the following schema when converting the SQL tables above:</p>

<pre><code class="language-java">comments.Id: int .
comments.Text: string .
comments.PostId: [uid] .
comments.UserId: [uid] .
posts.Body: string .
posts.Id: int .
posts.Title: string .
posts.AcceptedAnswerId: [uid] .
posts.OwnerUserId: [uid] .
posts.LastEditorUserId: [uid] .
users.DisplayName: string .
users.Id: int .
votes.CreationDate: string .
votes.Id: int .
votes.PostId: [uid] .
</code></pre>

<p>Once the migration tool finishes, two files will have been created:</p>

<ul>
<li>an RDF file is created containing all the N-Quad entries, and</li>
<li>a schema file.</li>
</ul>

<p>The two files can then be imported into Dgraph via the <a href="https://docs.dgraph.io/deploy/#live-loader">Dgraph Live Loader</a>
or <a href="https://docs.dgraph.io/deploy/#bulk-loader">Bulk Loader</a>. It&rsquo;s worth pointing out that sometimes you
may want to customize the schema, e.g. adding an index to a predicate, or by
changing an inter-object predicate from unidirectional to bidirectional links by adding the
<code>@reverse</code> directive. If you would like such customizations, you should do it by editing
the schema file generated by the migration tool before feeding the files to the Live Loader or Bulk Loader.</p>

<h3 id="demo-time">Demo time!</h3>

<p>It&rsquo;s time to sit back, relax, grab something to drink and enjoy a demo with the migration tool in action:</p>

<video controls autoplay loop muted playsinline width="100%">
  <source src="https://blog.dgraph.io/images/migration-tool.mp4" type="video/mp4" />
</video>

<p>The step-by-step instructions for running the demo can be found <a href="https://github.com/dgraph-io/dgraph/tree/master/dgraph/cmd/migrate">here</a>.</p>

<p>Besides the demo above, we&rsquo;ve tested the tool using a larger data set from the lifehacks site on <a href="https://archive.org/details/stackexchange">StackExchange</a>,
which showed us that for a dataset with around 10,000 rows the migration takes around 12 seconds (might vary on your machine).</p>

<h3 id="summary">Summary</h3>

<p>To recap, we presented the design of a migration tool that exports SQL tables into NQuad entries.
To make this blog easier to understand, we have simplified the problem, and left out some
tricky details such as multi-column foreign key constraints.
As a result, the gist of the design is straightforward and can be summarized into 3 rules:</p>

<ol>
<li>To generate unique blank node labels, the values in the primary key columns are appended to the table names if the table has a primary key; otherwise a counter is used.</li>
<li>Each SQL table cell is stored under a predicate name, which is constructed by concatenating the table name and the corresponding column name.</li>
<li>Inter-object relationships are derived by following foreign key constraints, where the blank nodes in the N-Quad objects are calculated through lookups in the target table.</li>
</ol>

<p>From there, the generated NQuad entries can be imported into Dgraph with the Live Loader or Bulk
Loader.</p>

<p>If you find this tool useful or have any suggestions for improvements, please drop us a note at
<a href="https://discuss.dgraph.io/">our discussion forum.</a></p>

                        </div>

                        
    <aside class="post__authors">
                <div class="tile author-tile">

    <img src="https://blog.dgraph.io/images/people/lucas.jpg" class="author-tile__photo">

    <h4 class="author-tile__title">
        <a href="https://blog.dgraph.io/authors/lucas/">Lucas Wang</a>,
        Author
    </h4>

    <p>Lucas is a distributed systems engineer at Dgraph Labs. He loves working with
distributed systems and algorithms, e.g. <a href="https://dgraph.io/">Dgraph</a>, <a href="https://cwiki.apache.org/confluence/display/KAFKA/KIP-291%3A+Separating+controller+connections+and+requests+from+the+data+plane">Kafka</a>,
<a href="https://lamport.azurewebsites.net/tla/tla.html">TLA+</a>. Before joining Dgraph, he was a member of the Kafka team at
LinkedIn.</p>


    

</div>

            
        

    </aside>



                        <div class="post__comments">

    <div id="discourse-comments"></div>

    
    <script type="text/javascript">
        DiscourseEmbed = {
            discourseUrl: "https:\/\/discuss.dgraph.io\/",
            topicId:  4545 
            };
        (function() {
            var d = document.createElement("script");
            d.type = "text/javascript";
            d.async = true;
            d.src = DiscourseEmbed.discourseUrl + "javascripts/embed.js";
            (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(d);
        })();
    </script>
    <noscript>Please enable JavaScript to view the comments on <a href="https://discuss.dgraph.io/">discuss</a>.</noscript>
    

</div>


                        <div class="modal fade" id="runnable-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <a href="#" data-dismiss="modal" class="modal-close-btn">
    Close
  </a>

  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-body">

      </div>
    </div>
  </div>
</div>

                    </div>
                </div>

                <div class="col-12 col-md-4 col-lg-3 offset-lg-1">
                    <div class="page-body__sidebar">

                        




<div class="post__related">

    <h3>Related Posts</h3>

    
    <div class="post">

        <div class="post__image">
    <img src="https://blog.dgraph.io//images/Jupiter%20North.jpg">
</div>


    	<div class="post__header">

    		<div class="post__date">

    
        Sun, May 3, 2020
    
    
</div>


    		<h4 class="post__title">
    			<a href="https://blog.dgraph.io/post/dgraph-graphql-hits-ga/">Dgraph GraphQL hits GA with v20.03.1</a>
    		</h4>

    		
<div class="post__byline">

    
            by <a href="https://blog.dgraph.io/authors/dmai/">Daniel Mai</a>
        
    

</div>



    	</div>

    </div>
    
    <div class="post">

        <div class="post__image">
    <img src="https://blog.dgraph.io//images/microgravity.jpg">
</div>


    	<div class="post__header">

    		<div class="post__date">

    
        Fri, Mar 20, 2020
    
    
</div>


    		<h4 class="post__title">
    			<a href="https://blog.dgraph.io/post/dgraph-calendar-versioning/">Why there would be no Dgraph 2.0: Goodbye Semantic Versioning</a>
    		</h4>

    		
<div class="post__byline">

    
            by <a href="https://blog.dgraph.io/authors/leyla/">Leyla Galatin</a>
        
    

</div>



    	</div>

    </div>
    

</div>



                        
<div class="post__tags">

    <h3>Tags</h3>

    <div>

        
            
            
                <a href="https://blog.dgraph.io/tags/dgraph/">dgraph</a>
            
        
            
            
                <a href="https://blog.dgraph.io/tags/sql/">sql</a>
            
        
            
            
                <a href="https://blog.dgraph.io/tags/migration/">migration</a>
            
        

    </div>

</div>



                        <aside class="post__cta">

    <h3>
        Deploy Dgraph<br>
        in Minutes
    </h3>

    <p>Dgraph does more than just simplify your workload. Discover what makes Dgraph GraphQL the best option for the job.</p>

    <a href="https://dgraph.io/downloads" class="button button--secondary">
        <span>Download</span>
        <i class=" fas fa-arrow-right"></i>
    </a>

</aside>


                    </div>
                </div>

            </div>
        </div>
    </section>

    <footer class="page-footer">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-5 col-sm-4">
        <div class="row">
          <div class="col-12 col-md-6 page-footer__nav">
            <h3 class="zeta">Products</h3>
            <ul>
              <li><a href="https://dgraph.io/graphql">GraphQL</a></li>
              <li><a href="https://dgraph.io/enterprise">Enterprise</a></li>
              <li><a href="https://dgraph.io/downloads">Downloads</a></li>
            </ul>
          </div>
          <div class="col-12 col-md-6 page-footer__nav">
            <h3 class="zeta">Learn</h3>
            <ul>
              <li><a href="https://dgraph.io/blog" target="_blank">Blog</a></li>
              <li><a href="https://tour.dgraph.io" target="_blank">Interactive Tour</a></li>
              <li><a href="https://discuss.dgraph.io" target="_blank">Forum</a></li>
              <li><a href="https://slack.dgraph.io" target="_blank">Slack</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-5 col-sm-4">
        <div class="row">
          <div class="col-12 col-md-6 page-footer__nav">
            <h3 class="zeta">Docs</h3>
            <ul>
              <li><a href="https://docs.dgraph.io" target="_blank">Dgraph Docs</a></li>
              <li><a href="https://graphql.dgraph.io/docs/" target="_blank">GraphQL Docs</a></li>
            </ul>
          </div>
          <div class="col-12 col-md-6 page-footer__nav">
            <h3 class="zeta">Company</h3>
            <ul>
              <li><a href="https://dgraph.io/about">Team</a></li>
              <li><a href="https://dgraph.io/careers">Careers</a></li>
              <li><a href="https://dgraph.io/contact">Contact</a></li>
              <li><a href="https://dgraph.io/conduct">Conduct</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-12 col-sm-6 col-md-4 col-lg-3 offset-lg-1 border-above-sm">
        <div class="page-footer__cta"><a href="https://dgraph.io/downloads" title="Download" class="button button--secondary"><span>Download</span><i class="fas fa-arrow-right"></i></a></div>
        <div class="page-footer__address">
          <p>
            655 Montgomery Street, 7th Floor<br>
            San Francisco, CA 94111
          </p>
          <hr>
          <p><a href="mailto:contact@dgraph.io">contact@dgraph.io</a></p>
        </div>
      </div>
    </div>
    <div class="page-footer__social">
      <ul>
        <li><a href="https://twitter.com/dgraphlabs" target="_blank"><i class="fab fa-twitter"></i></a></li>
        <li><a href="https://github.com/dgraph-io/dgraph" target="_blank"><i class="fab fa-github"></i></a></li>
        <li><a href="https://www.youtube.com/channel/UCghE41LR8nkKFlR3IFTRO4w" target="_blank"><i class="fab fa-youtube"></i></a></li>
        <li><a href="https://slack.dgraph.io" target="_blank"><i class="fab fa-slack"></i></a></li>
        <li><a href="https://www.linkedin.com/company/dgraph-labs" target="_blank"><i class="fab fa-linkedin"></i></a></li>
      </ul>
    </div>
    <div class="page-footer__copyright">
      <p>
        <Copyright>&copy; 2017-2020 Dgraph Labs, Inc.</Copyright>
      </p>
    </div>
  </div>
</footer>

    <script src="https://blog.dgraph.io//js/clipboard.min.js"></script>
    <script
      src='https://blog.dgraph.io//js/runnable.js?29f8ba4fb8d90804cf24ff53b70192ad'
    ></script>
    <script>
      hljs.initHighlightingOnLoad();
    </script>




<script>
  window.Countly = window.Countly || {};
  Countly.q = Countly.q || [];

  Countly.q.push(['track_sessions']);
  Countly.q.push(['track_pageview']);
  (function() {
  	var cly = document.createElement('script');
  	cly.type = 'text/javascript';
  	cly.async = true;
  	cly.src = "https://dgraph.io/assets/js/unminified/stats/dgraph-stats.min.js";
  	cly.onload = function() {
      Countly.init({
        app_key: "e93284ab5e5d21ef9eb16a94516b3c1c6eba1015",
        url: "https://stats.dgraph.io",
        force_post: true,
      })
  	};
  	document.body.appendChild(cly);
  })();
</script>


<script>
$(document.links)
  .filter(function() {
    return this.hostname != window.location.hostname;
  })
  .attr("target", "_blank");
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/visibility.js/1.2.4/visibility.min.js"></script>
<link href="https://fonts.googleapis.com/css?family=Indie+Flower" rel="stylesheet">
<link
  href='https://blog.dgraph.io//css/heart.css?24a50879951b2391f04750723b4a012e'
  rel="stylesheet">
<link
  href='https://blog.dgraph.io//css/github-engage.css?d60d80bf2b6a24350cdb5d834ab47e27'
  rel="stylesheet">

<script
  src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.min.js"
  integrity="sha256-7/yoZS3548fXSRXqc/xYzjsmuW3sFKzuvOCHd06Pmps="
  crossorigin="anonymous"
></script>
<script
  type="text/javascript"
  src='https://blog.dgraph.io//js/custom.js?94f0c667422b8dac293e14c9c49872e3'
></script>

<script src="//unpkg.com/@dgraph-io/community"></script>


</body>

    <script src="https://blog.dgraph.io/js/footnotes.js"></script>

</html>

