<!DOCTYPE html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1">
    <link rel="canonical" href="https://blog.dgraph.io/post/building-todo-list-react-dgraph/" />


    <link rel="apple-touch-icon" sizes="57x57" href="https://dgraph.io/assets/images/favicons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="https://dgraph.io/assets/images/favicons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://dgraph.io/assets/images/favicons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://dgraph.io/assets/images/favicons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://dgraph.io/assets/images/favicons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://dgraph.io/assets/images/favicons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://dgraph.io/assets/images/favicons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://dgraph.io/assets/images/favicons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://dgraph.io/assets/images/favicons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="https://dgraph.io/assets/images/favicons/android-icon-192x192.png">
    <link rel="manifest" href="https://dgraph.io/assets/images/favicons/manifest.json">
    <link rel="icon" type="image/png" sizes="32x32" href="https://dgraph.io/assets/images/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="https://dgraph.io/assets/images/favicons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://dgraph.io/assets/images/faviconsfavicon-16x16.png">
    <link rel="shortcut icon" href="https://dgraph.io/assets/images/favicons/favicon.ico">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="https://dgraph.io/assets/images/faviconsms-icon-144x144.png">
    <meta name="msapplication-config" content="https://dgraph.io/assets/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://blog.dgraph.io//index.xml">
  
    <title>Building a To-Do List React App with Dgraph - Dgraph Blog</title>
    <meta property='og:title' content="Building a To-Do List React App with Dgraph - Dgraph Blog">
    <meta property="og:type" content="article">
  

  <meta property="og:url" content="https://blog.dgraph.io/post/building-todo-list-react-dgraph/">
  
  <meta property="og:image" content="https://blog.dgraph.io//images/react-todomvc/react-localstore.png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js" integrity="sha256-0rguYS0qgS6L4qVzANq4kjxPLtvnp5nn2nB5G1lWRv4=" crossorigin="anonymous"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/styles/default.min.css" rel="stylesheet" integrity="sha256-Zd1icfZ72UBmsId/mUcagrmN7IN5Qkrvh75ICHIQVTk=" crossorigin="anonymous" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js" integrity="sha256-sNPiigbfSkqUzMc5rgrdztLnneCMAp6W9wetJUZu9Zw=" crossorigin="anonymous"></script>

  <link
    href='https://blog.dgraph.io//css/runnable.css?7bbf71b4888bc97241e85bc7326a12fe'
    rel="stylesheet"
  />
  <link
    href='https://blog.dgraph.io//css/runnable-custom.css?74110b504a7b8a6e92a95279cfa96032'
    rel="stylesheet"
  />

  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Mono:wght@400;500&display=swap" />

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />

  <link href="https://dgraph.io/assets/css/style.min.css?06042020-8" rel="stylesheet" type="text/css" />

  <link href="https://dgraph.io/assets/css/font-awesome/css/all.css" rel="stylesheet"/>

  <script
    src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/codemirror.js" integrity="sha256-x3BtPVERvw1ozPlwivuFLZoViFCeAAs1Gt6SxEedmo8=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/codemirror.css" integrity="sha256-7sZe9dsqyNZC9Mk+WPRB7nVvPPPXyorzm2QKqlgXC4k=" crossorigin="anonymous" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/addon/edit/closebrackets.min.js" integrity="sha256-qhu2a7DSpQaammMaLw1iruxBpxmgdw8mdQaQWQUokcY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/mode/javascript/javascript.min.js" integrity="sha256-7Bdg/UdDMmHDPafpQDYZNPCEbnRP7eAvu+2hEoqRCXs=" crossorigin="anonymous"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Merriweather+Sans:ital@1&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/algoliasearch@3/dist/algoliasearch.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.0.0/dist/instantsearch.production.min.js" integrity="sha256-6S7q0JJs/Kx4kb/fv0oMjS855QTz5Rc2hh9AkIUjUsk=" crossorigin="anonymous"></script>
  <script src="https://blog.dgraph.io//js/search.js?04292020"></script>

  
  
    
      <meta name="twitter:card" content="summary_large_image"/>
      <meta name="twitter:image" content="https://blog.dgraph.io//images/react-todomvc/react-localstore.png"/>
    
  

  <meta name="twitter:title" content="Building a To-Do List React App with Dgraph"/>
  <meta name="twitter:description" content="In this tutorial we will build a To-Do List application using React JavaScript library and Dgraph as a backend database."/>
  <meta name="twitter:site" content="@dgraphlabs"/>

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-666192333"></script>
  <script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'AW-666192333');</script>
</head>


<body class="blog-single has-lightning" data-gr-c-s-loaded="true">

    <header id="page-header" class="page-header">
	<div class="page-logo">
		<a href="https://dgraph.io/">
			<img src="https://dgraph.io/assets/images/logo.svg">
		</a>
	</div>
	<nav class="page-nav">
    <ul>
        <li>
            <div data-label="Products">
                <span>Products</span>
            </div>
            <ul>
                <li>
                    <a href="https://dgraph.io/graphql" data-label="GraphQL">
                        <span>GraphQL</span>
                    </a>
                </li>
                <li>
                    <a href="https://dgraph.io/enterprise" data-label="Enterprise">
                        <span>Enterprise</span>
                    </a>
                </li>
                <li>
                    <a href="https://dgraph.io/downloads" data-label="Downloads">
                        <span>Downloads</span>
                    </a>
                </li>
            </ul>
        </li>
        <li>
            <div data-label="Learn" class="is-active">
                <span>Learn</span>
            </div>
            <ul>
                <li>
                    <a href="https://dgraph.io/blog" data-label="Blog">
                        <span>Blog</span>
                    </a>
                </li>
                <li>
                    <a href="https://tour.dgraph.io" target="_blank" data-label="Interactive Tour">
                        <span>Interactive Tour</span>
                    </a>
                </li>
                <li>
                    <a href="https://discuss.dgraph.io" target="_blank" data-label="Forum">
                        <span>Forum</span>
                    </a>
                </li>
                <li>
                    <a href="https://slack.dgraph.io" target="_blank" data-label="Slack">
                        <span>Slack</span>
                    </a>
                </li>
            </ul>
        </li>
        <li>
            <div data-label="Docs"><span>Docs</span></div>
            <ul>
                <li>
                    <a href="https://docs.dgraph.io" target="_blank" data-label="Dgraph Docs">
                        <span>Dgraph Docs</span>
                    </a>
                </li>
                <li>
                    <a href="https://graphql.dgraph.io/docs/" target="_blank" data-label="GraphQL Docs">
                        <span>GraphQL Docs</span>
                    </a>
                </li>
            </ul>
        </li>
        <li>
            <div data-label="Company"><span>Company</span></div>
            <ul>
                <li>
                    <a href="https://dgraph.io/about" data-label="Team">
                        <span>Team</span>
                    </a>
                </li>
                <li>
                    <a href="https://dgraph.io/careers" data-label="Careers">
                        <span>Careers</span>
                    </a>
                </li>
                <li>
                    <a href="https://dgraph.io/contact" data-label="Contact">
                        <span>Contact</span>
                    </a>
                </li>
                <li>
                    <a href="https://dgraph.io/conduct" data-label="Conduct">
                        <span>Conduct</span>
                    </a>
                </li>
            </ul>
        </li>
    </ul>
</nav>

	<div class="page-cta">
    <ul>
        <li class="hide-tablet">
            <a href="https://dgraph.io/contact" title="Contact">Contact</a>
        </li>
        <li>
            <a href="https://dgraph.io/downloads" title="Download" class="button button--secondary">
                <span>Download</span>
                <i class="fas fa-arrow-right"></i>
            </a>
        </li>
    </ul>
</div>

</header>




    <section class="page-body">
        <div class="page-body__content">
            <div class="container">

                <div class="page-search">
	<div class="page-search__toggle" onClick="toggleVisibility()">
		<i class="fas fa-search"></i>
		<i class="fas fa-times"></i>
	</div>
</div>

          

            <div class="row">

                <div class="col-12 col-md-8">
                    <div class="page-body__content post">

                        <div class="post__meta">

                            <div class="post__date">

    
        Thu, Apr 18, 2019
    
    
</div>


                            <div class="post__share">
                                
                                    <a href="https://twitter.com/share?text=Building%20a%20To-Do%20List%20React%20App%20with%20Dgraph&amp;url=https%3a%2f%2fblog.dgraph.io%2fpost%2fbuilding-todo-list-react-dgraph%2f&amp;via=dgraphlabs" target="_blank">
                                        <i class="fab fa-twitter"></i>
                                    </a>
                                
                            </div>

                        </div>

                        <div class="post__cover">

                            <img src="https://blog.dgraph.io//images/react-todomvc/react-localstore.png">

                            <div class="post__header">

                                <h1 class="post__title">
                                    Building a To-Do List React App with Dgraph
                                </h1>

                                
<div class="post__byline">

    
            by <a href="https://blog.dgraph.io/authors/paul/">Paul Коrzhyk</a>
        
    

</div>



                            </div>

                        </div>

                        <div class="post__content inner-content">
                            

<p>In this tutorial we will build a To-Do List application using <a href="https://reactjs.org/">React</a> JavaScript library and Dgraph as a backend database.
We will use <a href="https://github.com/dgraph-io/dgraph-js-http">dgraph-js-http</a> &mdash; a library designed to greatly simplify the life of JavaScript developers when
accessing Dgraph databases.</p>

<p>The tutorial is split into several steps:</p>

<ol>
<li><p><a href="#ref-creating-app">Creating a React App</a></p></li>

<li><p><a href="#ref-docker-compose">Starting a local Dgraph server using docker-compose</a></p></li>

<li><p><a href="#ref-fetch-data">Connecting to Dgraph from JavaScript and fetching data</a></p></li>

<li><p><a href="#ref-write-data">Storing data in Dgraph</a></p></li>
</ol>

<p>If you are already familiar with setting up a React application and want to skip
straight to the Dgraph-specific part of the tutorial, you can start from <a href="#ref-docker-compose">Section 2</a>.</p>

<h3 id="1-creating-a-react-app-a-id-ref-creating-app-a">1. Creating a React App <a id="ref-creating-app"></a></h3>

<p>Nowadays it&rsquo;s pretty simple to get started with React, thanks to the awesome <code>create-react-app</code> script. Let&rsquo;s run it:</p>

<pre><code>  npx create-react-app dgraph-react-todomvc
</code></pre>

<p>(<code>npx</code> command is part a of the standard <a href="https://nodejs.org/en/download/">Node.js installation</a>.)</p>

<p><a href="https://blog.dgraph.io/images/react-todomvc/create-react-app.svg"><video autoplay loop muted playsinline width="100%">
  <source src="https://blog.dgraph.io/images/react-todomvc/create-react-app.mp4" type="video/mp4" />
</video></a></p>

<h4 id="verifying-the-new-app">Verifying the new app</h4>

<p>Let&rsquo;s compile and test our application. Like most tasks with <code>create-react-app</code> we need only one command to run
the development server and it will even open a browser window for us:</p>

<pre><code>  yarn start
</code></pre>

<p><img src="https://blog.dgraph.io/images/react-todomvc/helloworld.png" alt="Empty React App" /></p>

<p>Once we&rsquo;ve made sure everything is working as expected it&rsquo;s a good time to save our progress so far to a version control system.
At Dgraph we&rsquo;re using <a href="https://github.com/">GitHub</a> so I will just commit everything with Git:</p>

<pre><code> git commit -am 'Output of the create-react-app'
</code></pre>

<p>And since I&rsquo;ve created a public repository, you can <a href="https://github.com/dgraph-io/dgraph-react-todomvc/commits/master">view and clone</a>  all steps of this tutorial at any time.
(I won&rsquo;t digress on how I did this, as it goes beyond the scope of this tutorial.)</p>

<h4 id="adding-custom-code">Adding custom code</h4>

<p>So far we&rsquo;ve been generating boilerplate code not specific to the to-do application we&rsquo;re building.
It&rsquo;s time to make our app more unique, but as the first step, let&rsquo;s just delete all the styling we&rsquo;re not going to need.</p>

<p>As this is not a very creative process (quite the opposite of creative, actually) I won&rsquo;t go into details.
You can <a href="https://github.com/dgraph-io/dgraph-react-todomvc/commit/a18d1fd958ccc3c8d38940478746cf22c83c772f">view</a> the changed files on GitHub.</p>

<h4 id="connecting-todomvc-styles">Connecting TodoMVC styles</h4>

<p>Since I&rsquo;m not a designer, but still like my apps to look pretty, I&rsquo;m going to
use high quality off-the-shelf <a href="https://github.com/tastejs/todomvc-app-css">CSS styles</a>, released by the <a href="http://todomvc.com/">TodoMVC team</a>.</p>

<p>Adding those to the project is as easy as</p>

<pre><code> yarn add todomvc-app-css
</code></pre>

<p>We also need to load the new styles onto the page, by importing them in the <code>App.js</code>:</p>

<pre><code class="language-javascript">  import 'todomvc-app-css/index.css'
</code></pre>

<p>And after these two changes we can write some HTML to use the styles.
Let&rsquo;s update our main <code>render()</code> method to do just that (also in the <code>App.js</code>):</p>

<pre><code class="language-javascript">  ...
  render() {
    return (
      &lt;div&gt;
        &lt;header className=&quot;header&quot;&gt;
          &lt;h1&gt;todos&lt;/h1&gt;
          &lt;input
            className=&quot;new-todo&quot;
            placeholder=&quot;What needs to be done?&quot;
            autoFocus={true}
          /&gt;
        &lt;/header&gt;
      &lt;/div&gt;
    )
  }
  ...
</code></pre>

<p>Now, since we still have our dev server running in the background (the one we started with <code>yarn start</code>), our app will get live reloaded and start to look pretty fancy:</p>

<p><img src="https://blog.dgraph.io/images/react-todomvc/css-added.png" alt="Dummy page with fancy CSS" /></p>

<p>Sadly it isn&rsquo;t doing anything useful but we&rsquo;ll get to that in a minute.</p>

<p>I&rsquo;ve also made small tweaks to the <code>index.html</code> but those are fairly self-explanatory,
and can be seen in the <a href="https://github.com/dgraph-io/dgraph-react-todomvc/commit/1fbbda8263cb6c7ca0a6c910619080d50a5c2340#diff-528c3923d718a8860f5d8c05c3931c55">git history</a>.</p>

<h4 id="adding-react-components">Adding React Components</h4>

<p>There&rsquo;s just one more step before we get to the juicy bit - using Dgraph.
Trust me, I want to start telling you about it ASAP.</p>

<p>So, without further ado, let&rsquo;s get our frontend code done with by copying
the ready made React components from the <a href="https://github.com/tastejs/todomvc/tree/gh-pages/examples/react">TodoMVC React Example</a>.</p>

<p>The <a href="https://github.com/dgraph-io/dgraph-react-todomvc/commit/68a12fbb484db71c1ef988e16ba2febf39ea27a3">files I&rsquo;ve added</a> are somewhat different to the &ldquo;official&rdquo; TodoMVC React code because I&rsquo;ve modified the source to use all the shiny new features of modern JavaScript, Babel and Webpack: classes, modules, lambda functions, let/const keywords etc.</p>

<p>It&rsquo;s another hairy but straightforward refactoring, so let&rsquo;s not spend too much time on it.</p>

<p>After the dust settled our app can respond to the user input, show and store some to-dos:</p>

<p><img src="https://blog.dgraph.io/images/react-todomvc/react-localstore.png" alt="React App with LocalStore" /></p>

<h3 id="2-starting-a-local-dgraph-server-a-id-ref-docker-compose-a">2. Starting a local Dgraph server <a id="ref-docker-compose"></a></h3>

<p>There are many ways to <a href="https://docs.dgraph.io/get-started/">install and run Dgraph</a> depending on your machine setup.
I personally prefer to use <a href="https://docs.docker.com/compose/gettingstarted/"><code>docker-compose</code></a> as it keeps all of the configuration in one file.</p>

<p>First, let&rsquo;s create a <code>docker-compose.yml</code> configuration file.
It&rsquo;s up to you where you want to keep it, for our project the folder <code>dgraph-react-todomvc/dgraph/</code> seems logical.</p>

<pre><code>version: &quot;3.2&quot;
services:
  zero:
    image: dgraph/dgraph:v1.0.13
    volumes:
      - type: volume
        source: dgraph
        target: /dgraph
        volume:
          nocopy: true
    ports:
      - 5080:5080
      - 6080:6080
    restart: on-failure
    command: dgraph zero --my=zero:5080
  server:
    image: dgraph/dgraph:v1.0.13
    volumes:
      - type: volume
        source: dgraph
        target: /dgraph
        volume:
          nocopy: true
    ports:
      - 8080:8080
      - 9080:9080
    restart: on-failure
    command: dgraph alpha --my=server:7080 --lru_mb=2048 --zero=zero:5080
  ratel:
    image: dgraph/dgraph:v1.0.13
    volumes:
      - type: volume
        source: dgraph
        target: /dgraph
        volume:
          nocopy: true
    ports:
      - 8000:8000
    command: dgraph-ratel

volumes:
  dgraph:
</code></pre>

<p>Then we can fire up all three processes (Dgraph Alpha, Zero and Ratel) with
one simple command:</p>

<pre><code>  docker-compose up
</code></pre>

<p>I usually run it in a separate terminal so I can check the server output at any time or
shutdown everything by pressing <code>Ctrl+C</code>.</p>

<p>The output of <code>docker-compose</code> will be a bit noisy, but should look something like this:</p>

<p><a href="https://blog.dgraph.io/images/react-todomvc/docker-compose-up.svg"><video autoplay loop muted playsinline width="100%">
  <source src="https://blog.dgraph.io/images/react-todomvc/docker-compose-up.mp4" type="video/mp4" />
</video></a></p>

<h4 id="viewing-database-with-ratel-a-id-ref-test-ratel-a">Viewing database with Ratel <a id="ref-test-ratel"></a></h4>

<p>It sure looks like it&rsquo;s doing something how do we know if it works as expected?
Let&rsquo;s fire up a web browser and give Ratel a try &mdash; Dgraph&rsquo;s web UI.</p>

<p>Opening <a href="http://localhost:8000">http://localhost:8000</a> should take you to
the Ratel loading screen.</p>

<p>From there you can click on <a href="http://localhost:8000/?latest">🚀 Launch Latest</a> to load
the latest stable version of Ratel and run some queries:</p>

<p><img src="https://blog.dgraph.io/images/react-todomvc/ratel.gif" alt="Ratel first steps" /></p>

<h3 id="3-connecting-to-dgraph-from-javascript-and-fetching-data-a-id-ref-fetch-data-a">3. Connecting to Dgraph from JavaScript and fetching data <a id="ref-fetch-data"></a></h3>

<p>Dgraph team has built <a href="https://docs.dgraph.io/clients/">client libraries</a> for various languages.
Since we are building a web app without a backend server, and JavaScript in the browser
is very restricted in what it is allowed to do, we will be using
<a href="https://github.com/dgraph-io/dgraph-js-http">dgraph-js-http</a>.</p>

<p>You may have noticed there&rsquo;s also <a href="https://github.com/dgraph-io/dgraph-js">dgraph-js</a>
available via <code>npm</code>.</p>

<p>The main difference between the two is <code>dgraph-js-http</code> communicates with Dgraph via
HTTP queries and <code>dgraph-js</code> uses network sockets and <a href="https://grpc.io/">gRPC</a>.
gRPC is more efficient, but currently there&rsquo;s no network sockets API available to webpages.
Therefore <code>dgraph-js-http</code> is our only option.
For many use cases, the difference in performance is negligible so let&rsquo;s start building our
application around the HTTP protocol.</p>

<h4 id="installing-dgraph-js-http">Installing <code>dgraph-js-http</code></h4>

<p>As with any other npm package, adding <code>dgraph-js-http</code> to our project is super simple:</p>

<pre><code>  yarn install dgraph-js-http
</code></pre>

<p>And after yarn has downloaded the latest version of the package, we can import it
in our <code>TodoModel.js</code>:</p>

<pre><code class="language-javascript">import * as dgraph from 'dgraph-js-http'
</code></pre>

<p>In order to communicate with Dgraph we need to create an instance of the <code>DgraphClient</code>.
Let&rsquo;s do it inside our <code>TodoModel</code> constructor:</p>

<pre><code class="language-javascript">  const clientStub = new dgraph.DgraphClientStub(&quot;http://localhost:8080&quot;)
  this.dgraph = new dgraph.DgraphClient(clientStub)
</code></pre>

<p>With a client object ready we can fetch to-dos using a <a href="https://docs.dgraph.io/query-language/">GraphQL+- query</a>:</p>

<pre><code class="language-javascript">  async fetchTodos() {
    const query = `{
      todos(func: has(is_todo))
      {
        uid
        title
        completed
      }
    }`
    const res = await this.dgraph.newTxn().query(query)
    return res.data.todos || []
  }
</code></pre>

<p>We also need to call <code>fetchTodos()</code> when our web app is loaded, store its result
inside the model, and also get rid of the no-longer-needed localStorage code.</p>

<p>For the former task I&rsquo;ve created a helper method <code>fetchAndInform()</code>:</p>

<pre><code class="language-javascript">  async fetchAndInform() {
    this.todos = await this.fetchTodos()
    this.inform()
  }
</code></pre>

<p>And placed it as the last call in the <code>TodoModel</code> constructor:</p>

<pre><code class="language-javascript">  constructor() {
    const clientStub = new dgraph.DgraphClientStub(&quot;http://localhost:8080&quot;)
    this.dgraph = new dgraph.DgraphClient(clientStub)

    this.todos = []
    this.fetchAndInform()
  }
</code></pre>

<p>As the final touch, we can stop manually generating unique <code>id</code>s and
start using much more compact and efficient Dgraph&rsquo;s <code>uid</code> field:</p>

<p><img src="https://blog.dgraph.io/images/react-todomvc/uid-diff.svg" alt="Use uid instead of id" /></p>

<p>All the major changes I&rsquo;ve outlined above and some minor cleanups I&rsquo;ve omitted
are available in this <a href="https://github.com/dgraph-io/dgraph-react-todomvc/commit/042ee296283f10994fa35e2ba6e0e6b98a06168d">GitHub commit</a>.</p>

<h4 id="adding-test-data-to-dgraph">Adding test data to Dgraph</h4>

<p>So we&rsquo;ve written a bit of code, removed a bit more, but how do we know if it&rsquo;s actually
working as expected?</p>

<p>If we simply reload the web app we will see an empty to-do list.
Any items we add via the UI disappear on browser refresh.</p>

<p>That is happening because our Dgraph database is empty at the moment and we haven&rsquo;t
coded our components to populate it yet.</p>

<p>Every time the page is refreshed our query returns an empty set of to-dos, and
that is what we see on the webpage.</p>

<p>Since we have the Ratel UI (we <a href="#ref-test-ratel">have already played with it</a>)
we can easily add some test data.</p>

<p>Let&rsquo;s open our local Ratel instance (<a href="http://localhost:8000/?latest">http://localhost:8000/?latest</a>) and execute
the following mutation:</p>

<pre><code>{
  &quot;set&quot;: [
    {
      &quot;uid&quot;: &quot;_:todo1&quot;,
      &quot;is_todo&quot;: &quot;true&quot;,
      &quot;title&quot;: &quot;First Todo&quot;,
      &quot;completed&quot;: &quot;false&quot;
    },
    {
      &quot;uid&quot;: &quot;_:todo2&quot;,
      &quot;is_todo&quot;: &quot;true&quot;,
      &quot;title&quot;: &quot;Second Todo&quot;,
      &quot;completed&quot;: &quot;true&quot;
    }
  ]
}
</code></pre>

<p>In Ratel the successful response should look like this:</p>

<p><img src="https://blog.dgraph.io/images/react-todomvc/ratel-mutation.png" alt="Mutation result in Ratel" /></p>

<p>Note that we needed to click the &ldquo;Mutate&rdquo; radio button.</p>

<p>Ratel also lets us test the query our application is sending:</p>

<p><a id="ref-img-ratel-query"></a>
<img src="https://blog.dgraph.io/images/react-todomvc/ratel-query.png" alt="Query result in Ratel" /></p>

<p>Now, after we made sure we have the right data in the database, let&rsquo;s see if
our application is accessing it correctly:</p>

<p><img src="https://blog.dgraph.io/images/react-todomvc/app-badschema.png" alt="To-do items marked as completed" /></p>

<p>This is almost perfect, except our mutation said only the second to-do was completed,
but the first was not. Why did this happen?</p>

<p>If you take a closer look at the Ratel query <a href="#ref-img-ratel-query">screenshot</a> above,
you will notice that <code>completed</code> is returned as a JSON string, not a boolean:</p>

<pre><code class="language-javascript">  ...
      {
        &quot;uid&quot;: &quot;0x3&quot;,
        &quot;title&quot;: &quot;First Todo&quot;,
        &quot;completed&quot;: &quot;false&quot;
      },
  ...
</code></pre>

<p>That second pair of double quotes does matter in the line <code>&quot;completed&quot;: &quot;false&quot;</code>.
We have not yet told Dgraph to parse the values of <code>completed</code> as booleans,
so Dgraph is storing and returning them as strings. To change that we will need to adjust Schema.</p>

<h4 id="modifying-schema-with-ratel">Modifying Schema with Ratel</h4>

<p>As we have determined, we need to tell Dgraph to convert the <code>completed</code> predicate
from string to boolean.</p>

<p>Ratel has full support for managing Dgraph schemas, so such changes takes
only a handful of clicks:</p>

<p><img src="https://blog.dgraph.io/images/react-todomvc/alter-schema.png" alt="Modifying schemas with Ratel" /></p>

<p>After we&rsquo;ve modified the schema Dgraph takes care of the rest &mdash; it will migrate
existing data to the new type and will start responding to new queries with values
coerced to the right data type.</p>

<p>We can verify that this is actually happening by re-running the query in Ratel,
or by refreshing our TodoMVC app:</p>

<table>
<thead>
<tr>
<th>Ratel</th>
<th>TodoMVC</th>
</tr>
</thead>

<tbody>
<tr>
<td><a href="https://blog.dgraph.io/images/react-todomvc/ratel-goodschema.png"><img src="https://blog.dgraph.io/images/react-todomvc/ratel-goodschema.png" alt="Correct data type in Ratel" /></a></td>
<td><a href="https://blog.dgraph.io/images/react-todomvc/app-goodschema.png"><img src="https://blog.dgraph.io/images/react-todomvc/app-goodschema.png" alt="Correct completed status in TodoMVC" /></a></td>
</tr>
</tbody>
</table>

<h3 id="4-storing-data-in-dgraph-a-id-ref-write-data-a">4. Storing data in Dgraph <a id="ref-write-data"></a></h3>

<p>We have learned how to query Dgraph for data and show results to the user.
The only missing piece of the puzzle is writing our to-dos to Dgraph so they don&rsquo;t get lost
every time our users close a browser tab.</p>

<p>Let&rsquo;s start by sending newly created to-dos to Dgraph, and then we&rsquo;ll write code for updating or deleting the existing ones.</p>

<h4 id="creating-new-to-do-items-in-dgraph">Creating new to-do items in Dgraph</h4>

<p>We represent to-do items as graph nodes. To create a new node we&rsquo;ll need a transaction, and a mutation:</p>

<pre><code class="language-javascript">  async addTodo(title) {
    try {
      const res = await this.dgraph.newTxn().mutate({
        setJson: {
          uid: &quot;_:newTodo&quot;,
          is_todo: true,
          title,
          completed: false,
        },
        commitNow: true,
      })

      console.info('Created new to-do with uid', res.data.uids.newTodo)
    } catch (error) {
      alert('Database write failed!')
      console.error('Network error', error)
    } finally {
      this.fetchAndInform()
    }
  }
</code></pre>

<p><code>commitNow</code> informs Dgraph that this transaction will not modify any more data and
should be committed right away.</p>

<p>In a more complex application we could set it to <code>false</code> (or omit it altogether) if we planned to perform more reads or mutations. In that case we&rsquo;d have to manually call
<a href="https://github.com/dgraph-io/dgraph-js-http#commit-a-transaction"><code>commit()</code></a> at the right moment.</p>

<p>Note how the response object contains the <code>uid</code> of the newly created item.
Since we used the alias <code>&quot;_:newTodo&quot;</code> in our <code>setJson</code> mutation, the uid of that node
is stored in the <code>uids.newTodo</code> of the response data.</p>

<p>Our application can now write data to Dgraph, and we can see auto-incremented <code>uid</code> values printed to console:</p>

<p><img src="https://blog.dgraph.io/images/react-todomvc/create-todo.png" alt="Creating to-dos in Dgraph" /></p>

<p>You can also go to Ratel and re-run our query &mdash; the new to-dos will appear in the response.</p>

<h4 id="deleting-nodes-from-dgraph">Deleting nodes from Dgraph</h4>

<p>Code to delete a to-do is very similar to that for creating a to-do.
We only need to specify a <code>uid</code> of the node being deleted, and use the <code>deleteJson</code> field
on the mutation object:</p>

<pre><code class="language-javascript">  async destroy(todo) {
    try {
      await this.dgraph.newTxn().mutate({
        deleteJson: {
          uid: todo.uid
        },
        commitNow: true,
      })
    } catch (error) {
      alert('Database write failed!')
      console.error('Network error', error)
    } finally {
      this.fetchAndInform()
    }
  }
</code></pre>

<p>Deleting multiple to-dos for the <code>clearCompleted()</code> method can be done by passing an
array in the <code>deleteJson</code>:</p>

<pre><code class="language-javascript">    ...
    const uidsToDelete = this.todos
        .filter(({ completed }) =&gt; completed)
        .map(({ uid }) =&gt; ({ uid }))

    await this.dgraph.newTxn().mutate({
      deleteJson: uidsToDelete,
      commitNow: true,
    })
    ...
</code></pre>

<h4 id="updating-data-in-dgraph">Updating data in Dgraph</h4>

<p>Our application can create new to-dos in the database, can read the data back, and
can remove unnecessary data.</p>

<p>We just need to enable our users to edit their existing to-dos and we&rsquo;re done!</p>

<p>As you may have guessed already, editing a node property is just another transaction:</p>

<pre><code class="language-javascript">  async save(todoToSave, newTitle) {
    try {
      await this.dgraph.newTxn().mutate({
        setJson: {
          uid: todoToSave.uid,
          title: newTitle,
        },
        commitNow: true,
      })
    } catch (error) {
      console.error('Network error', error)
    } finally {
      this.fetchAndInform()
    }
  }
</code></pre>

<p>We don&rsquo;t need to pass the entire object back to Dgraph. We only include the new value for <code>title</code> in our mutation. Other predicates (such as <code>completed</code>) will have their values preserved.</p>

<p>Methods that change completion status, <code>toggle(...)</code> and <code>toggleAll(...)</code>, also need to be rewritten
to use Dgraph transactions, but this exercise is <a href="https://github.com/dgraph-io/dgraph-react-todomvc/commit/876b5af1e99308c42bbcb72ffe3082dbbd6e5914">left to the reader ;)</a>.</p>

<p>Here&rsquo;s the final product:</p>

<!-- ffmpeg script to convert gif to mp4 https://gist.github.com/ingramchen/e2af352bf8b40bb88890fba4f47eccd0 -->

<!-- not as simple as "ffmpeg -i a.gif a.mp4" because that doesn't work in Firefox -->

<video autoplay loop muted playsinline width="100%">
  <source src="https://blog.dgraph.io/images/react-todomvc/todos-livedemo.mp4" type="video/mp4" />
</video>

<h3 id="summary">Summary</h3>

<p>We have built a web app that is capable of accessing Dgraph to store and display data.
To do that we have learned how to run Dgraph inside Docker containers, adjusted schema in Ratel,
and learned how to send GraphQL+- queries to read data and to commit transactions in order to insert or modify data in Dgraph.</p>

<p>There are many more things a developer of a real-life application would need to implement.
Most notably I&rsquo;ve omitted access control and backups, among other things.
However, I hope this tutorial gave you an interesting and useful starting point for
creating your own Dgraph-powered applications.</p>

                        </div>

                        
    <aside class="post__authors">
                <div class="tile author-tile">

    <img src="https://blog.dgraph.io/images/people/paul.png" class="author-tile__photo">

    <h4 class="author-tile__title">
        <a href="https://blog.dgraph.io/authors/paul/">Paul Коrzhyk</a>,
        Author
    </h4>

    <p>Paul has a Masters of Computer Science degree with focus on Artificial
Intelligence. He has worked with all layers of the computing stack: from
Assembler on microcontrollers to animations in JavaScript; solved technical
challenges at companies of different sizes: from being the first hire to working
at a 20,000-strong megacorp; and wore different hats: from a Junior Engineer to
a Senior Architect and a CTO. In his spare time he likes to keep learning new
technologies, travel, and exercise.</p>


    
        <nav class="author-tile__social">

            
                <a href="https://www.linkedin.com/in/paulftw/" target="_blank">
                    <i class="fab fa-linkedin"></i>
                </a>
            

            
                <a href="https://twitter.com/paulkorgeous" target="_blank">
                    <i class="fab fa-twitter"></i>
                </a>
            

            
                <a href="https://github.com/paulftw" target="_blank">
                    <i class="fab fa-github"></i>
                </a>
            

        </nav>
    

</div>

            
        

    </aside>



                        <div class="post__comments">

    <div id="discourse-comments"></div>

    
    <script type="text/javascript">
        DiscourseEmbed = {
            discourseUrl: "https:\/\/discuss.dgraph.io\/",
            topicId:  4355 
            };
        (function() {
            var d = document.createElement("script");
            d.type = "text/javascript";
            d.async = true;
            d.src = DiscourseEmbed.discourseUrl + "javascripts/embed.js";
            (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(d);
        })();
    </script>
    <noscript>Please enable JavaScript to view the comments on <a href="https://discuss.dgraph.io/">discuss</a>.</noscript>
    

</div>


                        <div class="modal fade" id="runnable-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <a href="#" data-dismiss="modal" class="modal-close-btn">
    Close
  </a>

  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-body">

      </div>
    </div>
  </div>
</div>

                    </div>
                </div>

                <div class="col-12 col-md-4 col-lg-3 offset-lg-1">
                    <div class="page-body__sidebar">

                        




<div class="post__related">

    <h3>Related Posts</h3>

    
    <div class="post">

        <div class="post__image">
    <img src="https://blog.dgraph.io//images/graphql/cover-1.png">
</div>


    	<div class="post__header">

    		<div class="post__date">

    
        Sun, Apr 12, 2020
    
    
</div>


    		<h4 class="post__title">
    			<a href="https://blog.dgraph.io/post/designing-graphql-schemas/">Designing GraphQL schemas</a>
    		</h4>

    		
<div class="post__byline">

    
            by <a href="https://blog.dgraph.io/authors/karthic/">Karthic Rao</a>
        
    

</div>



    	</div>

    </div>
    
    <div class="post">

        <div class="post__image">
    <img src="https://blog.dgraph.io//images/tutorials/8/cover.jpg">
</div>


    	<div class="post__header">

    		<div class="post__date">

    
        Tue, Jan 28, 2020
    
    
</div>


    		<h4 class="post__title">
    			<a href="https://blog.dgraph.io/post/tutorial-8-getting-started/">Getting started with Dgraph-8: Easily build location-aware apps using our native geolocation features</a>
    		</h4>

    		
<div class="post__byline">

    
            by <a href="https://blog.dgraph.io/authors/karthic/">Karthic Rao</a>
        
    

</div>



    	</div>

    </div>
    

</div>



                        
<div class="post__tags">

    <h3>Tags</h3>

    <div>

        
            
            
                <a href="https://blog.dgraph.io/tags/javascript/">javascript</a>
            
        
            
            
                <a href="https://blog.dgraph.io/tags/react/">react</a>
            
        
            
            
                <a href="https://blog.dgraph.io/tags/tutorial/">tutorial</a>
            
        

    </div>

</div>



                        <aside class="post__cta">

    <h3>
        Deploy Dgraph<br>
        in Minutes
    </h3>

    <p>Dgraph does more than just simplify your workload. Discover what makes Dgraph GraphQL the best option for the job.</p>

    <a href="https://dgraph.io/downloads" class="button button--secondary">
        <span>Download</span>
        <i class=" fas fa-arrow-right"></i>
    </a>

</aside>


                    </div>
                </div>

            </div>
        </div>
    </section>

    <footer class="page-footer">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-5 col-sm-4">
        <div class="row">
          <div class="col-12 col-md-6 page-footer__nav">
            <h3 class="zeta">Products</h3>
            <ul>
              <li><a href="https://dgraph.io/graphql">GraphQL</a></li>
              <li><a href="https://dgraph.io/enterprise">Enterprise</a></li>
              <li><a href="https://dgraph.io/downloads">Downloads</a></li>
            </ul>
          </div>
          <div class="col-12 col-md-6 page-footer__nav">
            <h3 class="zeta">Learn</h3>
            <ul>
              <li><a href="https://dgraph.io/blog" target="_blank">Blog</a></li>
              <li><a href="https://tour.dgraph.io" target="_blank">Interactive Tour</a></li>
              <li><a href="https://discuss.dgraph.io" target="_blank">Forum</a></li>
              <li><a href="https://slack.dgraph.io" target="_blank">Slack</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-5 col-sm-4">
        <div class="row">
          <div class="col-12 col-md-6 page-footer__nav">
            <h3 class="zeta">Docs</h3>
            <ul>
              <li><a href="https://docs.dgraph.io" target="_blank">Dgraph Docs</a></li>
              <li><a href="https://graphql.dgraph.io/docs/" target="_blank">GraphQL Docs</a></li>
            </ul>
          </div>
          <div class="col-12 col-md-6 page-footer__nav">
            <h3 class="zeta">Company</h3>
            <ul>
              <li><a href="https://dgraph.io/about">Team</a></li>
              <li><a href="https://dgraph.io/careers">Careers</a></li>
              <li><a href="https://dgraph.io/contact">Contact</a></li>
              <li><a href="https://dgraph.io/conduct">Conduct</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-12 col-sm-6 col-md-4 col-lg-3 offset-lg-1 border-above-sm">
        <div class="page-footer__cta"><a href="https://dgraph.io/downloads" title="Download" class="button button--secondary"><span>Download</span><i class="fas fa-arrow-right"></i></a></div>
        <div class="page-footer__address">
          <p>
            655 Montgomery Street, 7th Floor<br>
            San Francisco, CA 94111
          </p>
          <hr>
          <p><a href="mailto:contact@dgraph.io">contact@dgraph.io</a></p>
        </div>
      </div>
    </div>
    <div class="page-footer__social">
      <ul>
        <li><a href="https://twitter.com/dgraphlabs" target="_blank"><i class="fab fa-twitter"></i></a></li>
        <li><a href="https://github.com/dgraph-io/dgraph" target="_blank"><i class="fab fa-github"></i></a></li>
        <li><a href="https://www.youtube.com/channel/UCghE41LR8nkKFlR3IFTRO4w" target="_blank"><i class="fab fa-youtube"></i></a></li>
        <li><a href="https://slack.dgraph.io" target="_blank"><i class="fab fa-slack"></i></a></li>
        <li><a href="https://www.linkedin.com/company/dgraph-labs" target="_blank"><i class="fab fa-linkedin"></i></a></li>
      </ul>
    </div>
    <div class="page-footer__copyright">
      <p>
        <Copyright>&copy; 2017-2020 Dgraph Labs, Inc.</Copyright>
      </p>
    </div>
  </div>
</footer>

    <script src="https://blog.dgraph.io//js/clipboard.min.js"></script>
    <script
      src='https://blog.dgraph.io//js/runnable.js?29f8ba4fb8d90804cf24ff53b70192ad'
    ></script>
    <script>
      hljs.initHighlightingOnLoad();
    </script>




<script>
  window.Countly = window.Countly || {};
  Countly.q = Countly.q || [];

  Countly.q.push(['track_sessions']);
  Countly.q.push(['track_pageview']);
  (function() {
  	var cly = document.createElement('script');
  	cly.type = 'text/javascript';
  	cly.async = true;
  	cly.src = "https://dgraph.io/assets/js/unminified/stats/dgraph-stats.min.js";
  	cly.onload = function() {
      Countly.init({
        app_key: "e93284ab5e5d21ef9eb16a94516b3c1c6eba1015",
        url: "https://stats.dgraph.io",
        force_post: true,
      })
  	};
  	document.body.appendChild(cly);
  })();
</script>


<script>
$(document.links)
  .filter(function() {
    return this.hostname != window.location.hostname;
  })
  .attr("target", "_blank");
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/visibility.js/1.2.4/visibility.min.js"></script>
<link href="https://fonts.googleapis.com/css?family=Indie+Flower" rel="stylesheet">
<link
  href='https://blog.dgraph.io//css/heart.css?24a50879951b2391f04750723b4a012e'
  rel="stylesheet">
<link
  href='https://blog.dgraph.io//css/github-engage.css?d60d80bf2b6a24350cdb5d834ab47e27'
  rel="stylesheet">

<script
  src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.min.js"
  integrity="sha256-7/yoZS3548fXSRXqc/xYzjsmuW3sFKzuvOCHd06Pmps="
  crossorigin="anonymous"
></script>
<script
  type="text/javascript"
  src='https://blog.dgraph.io//js/custom.js?94f0c667422b8dac293e14c9c49872e3'
></script>

<script src="//unpkg.com/@dgraph-io/community"></script>


</body>

    <script src="https://blog.dgraph.io/js/footnotes.js"></script>

</html>

