<!DOCTYPE html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1">
    <link rel="canonical" href="https://blog.dgraph.io/post/building-graphoverflow/" />


    <link rel="apple-touch-icon" sizes="57x57" href="https://dgraph.io/assets/images/favicons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="https://dgraph.io/assets/images/favicons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://dgraph.io/assets/images/favicons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://dgraph.io/assets/images/favicons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://dgraph.io/assets/images/favicons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://dgraph.io/assets/images/favicons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://dgraph.io/assets/images/favicons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://dgraph.io/assets/images/favicons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://dgraph.io/assets/images/favicons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="https://dgraph.io/assets/images/favicons/android-icon-192x192.png">
    <link rel="manifest" href="https://dgraph.io/assets/images/favicons/manifest.json">
    <link rel="icon" type="image/png" sizes="32x32" href="https://dgraph.io/assets/images/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="https://dgraph.io/assets/images/favicons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://dgraph.io/assets/images/faviconsfavicon-16x16.png">
    <link rel="shortcut icon" href="https://dgraph.io/assets/images/favicons/favicon.ico">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="https://dgraph.io/assets/images/faviconsms-icon-144x144.png">
    <meta name="msapplication-config" content="https://dgraph.io/assets/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://blog.dgraph.io//index.xml">
  
    <title>Building a Stack Overflow Clone with Dgraph, and React - Dgraph Blog</title>
    <meta property='og:title' content="Building a Stack Overflow Clone with Dgraph, and React - Dgraph Blog">
    <meta property="og:type" content="article">
  

  <meta property="og:url" content="https://blog.dgraph.io/post/building-graphoverflow/">
  
  <meta property="og:image" content="https://blog.dgraph.io//images/graphoverflow-node-cover.jpg">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js" integrity="sha256-0rguYS0qgS6L4qVzANq4kjxPLtvnp5nn2nB5G1lWRv4=" crossorigin="anonymous"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/styles/default.min.css" rel="stylesheet" integrity="sha256-Zd1icfZ72UBmsId/mUcagrmN7IN5Qkrvh75ICHIQVTk=" crossorigin="anonymous" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js" integrity="sha256-sNPiigbfSkqUzMc5rgrdztLnneCMAp6W9wetJUZu9Zw=" crossorigin="anonymous"></script>

  <link
    href='https://blog.dgraph.io//css/runnable.css?7bbf71b4888bc97241e85bc7326a12fe'
    rel="stylesheet"
  />
  <link
    href='https://blog.dgraph.io//css/runnable-custom.css?74110b504a7b8a6e92a95279cfa96032'
    rel="stylesheet"
  />

  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Mono:wght@400;500&display=swap" />

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />

  <link href="https://dgraph.io/assets/css/style.min.css?05042020-3" rel="stylesheet" type="text/css" />

  <link href="https://dgraph.io/assets/css/font-awesome/css/all.css" rel="stylesheet"/>

  <script
    src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/codemirror.js" integrity="sha256-x3BtPVERvw1ozPlwivuFLZoViFCeAAs1Gt6SxEedmo8=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/codemirror.css" integrity="sha256-7sZe9dsqyNZC9Mk+WPRB7nVvPPPXyorzm2QKqlgXC4k=" crossorigin="anonymous" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/addon/edit/closebrackets.min.js" integrity="sha256-qhu2a7DSpQaammMaLw1iruxBpxmgdw8mdQaQWQUokcY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/mode/javascript/javascript.min.js" integrity="sha256-7Bdg/UdDMmHDPafpQDYZNPCEbnRP7eAvu+2hEoqRCXs=" crossorigin="anonymous"></script>
  

  <script src="https://cdn.jsdelivr.net/npm/algoliasearch@3/dist/algoliasearch.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.0.0/dist/instantsearch.production.min.js" integrity="sha256-6S7q0JJs/Kx4kb/fv0oMjS855QTz5Rc2hh9AkIUjUsk=" crossorigin="anonymous"></script>
  <script src="https://blog.dgraph.io//js/search.js?04292020"></script>

  
  
    
      <meta name="twitter:card" content="summary_large_image"/>
      <meta name="twitter:image" content="https://blog.dgraph.io//images/graphoverflow-node-cover.jpg"/>
    
  

  <meta name="twitter:title" content="Building a Stack Overflow Clone with Dgraph, and React"/>
  <meta name="twitter:description" content="I have recently built a Stack Overflow clone with Dgraph and React. I was delightfully surprised by the pleasant developer experience and the performance of my application. In this post, I would like to tell the story of how I built Graphoverflow and share the best practices I learned for using Dgraph to build a modern web application."/>
  <meta name="twitter:site" content="@dgraphlabs"/>

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-666192333"></script>
  <script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'AW-666192333');</script>
</head>


<body class="blog-single has-lightning" data-gr-c-s-loaded="true">

    <header id="page-header" class="page-header">
	<div class="page-logo">
		<a href="https://dgraph.io/">
			<img src="https://dgraph.io/assets/images/logo.svg">
		</a>
	</div>
	<nav class="page-nav">
    <ul>
        <li>
            <div data-label="Products">
                <span>Products</span>
            </div>
            <ul>
                <li>
                    <a href="https://dgraph.io/graphql" data-label="GraphQL">
                        <span>GraphQL</span>
                    </a>
                </li>
                <li>
                    <a href="https://dgraph.io/enterprise" data-label="Enterprise">
                        <span>Enterprise</span>
                    </a>
                </li>
                <li>
                    <a href="https://dgraph.io/downloads" data-label="Downloads">
                        <span>Downloads</span>
                    </a>
                </li>
            </ul>
        </li>
        <li>
            <div data-label="Learn" class="is-active">
                <span>Learn</span>
            </div>
            <ul>
                <li>
                    <a href="https://dgraph.io/blog" data-label="Blog">
                        <span>Blog</span>
                    </a>
                </li>
                <li>
                    <a href="https://tour.dgraph.io" target="_blank" data-label="Interactive Tour">
                        <span>Interactive Tour</span>
                    </a>
                </li>
                <li>
                    <a href="https://discuss.dgraph.io" target="_blank" data-label="Forum">
                        <span>Forum</span>
                    </a>
                </li>
                <li>
                    <a href="https://slack.dgraph.io" target="_blank" data-label="Slack">
                        <span>Slack</span>
                    </a>
                </li>
            </ul>
        </li>
        <li>
            <div data-label="Docs"><span>Docs</span></div>
            <ul>
                <li>
                    <a href="https://docs.dgraph.io" target="_blank" data-label="Dgraph Docs">
                        <span>Dgraph Docs</span>
                    </a>
                </li>
                <li>
                    <a href="https://graphql.dgraph.io/docs/" target="_blank" data-label="GraphQL Docs">
                        <span>GraphQL Docs</span>
                    </a>
                </li>
            </ul>
        </li>
        <li>
            <div data-label="Company"><span>Company</span></div>
            <ul>
                <li>
                    <a href="https://dgraph.io/about" data-label="Team">
                        <span>Team</span>
                    </a>
                </li>
                <li>
                    <a href="https://dgraph.io/careers" data-label="Careers">
                        <span>Careers</span>
                    </a>
                </li>
                <li>
                    <a href="https://dgraph.io/contact" data-label="Contact">
                        <span>Contact</span>
                    </a>
                </li>
                <li>
                    <a href="https://dgraph.io/conduct" data-label="Conduct">
                        <span>Conduct</span>
                    </a>
                </li>
            </ul>
        </li>
    </ul>
</nav>

	<div class="page-cta">
    <ul>
        <li class="hide-tablet">
            <a href="https://dgraph.io/contact" title="Contact">Contact</a>
        </li>
        <li>
            <a href="https://dgraph.io/downloads" title="Download" class="button button--secondary">
                <span>Download</span>
                <i class="fas fa-arrow-right"></i>
            </a>
        </li>
    </ul>
</div>

</header>




    <section class="page-body">
        <div class="container">
            <div class="row">

                <div class="col-12 col-md-8">
                    <div class="page-body__content post">

                        <div class="post__meta">

                            <div class="post__date">

    
        Wed, Aug 2, 2017
    
    
</div>


                            <div class="post__share">
                                
                                    <a href="https://twitter.com/share?text=Building%20a%20Stack%20Overflow%20Clone%20with%20Dgraph%2c%20and%20React&amp;url=https%3a%2f%2fblog.dgraph.io%2fpost%2fbuilding-graphoverflow%2f&amp;via=dgraphlabs" target="_blank">
                                        <i class="fab fa-twitter"></i>
                                    </a>
                                
                            </div>

                        </div>

                        <div class="post__cover">

                            <img src="https://blog.dgraph.io//images/graphoverflow-node-cover.jpg">

                            <div class="post__header">

                                <h1 class="post__title">
                                    Building a Stack Overflow Clone with Dgraph, and React
                                </h1>

                                
<div class="post__byline">

    
            by <a href="https://blog.dgraph.io/authors/sung/">Sung Won Cho</a>
        
    

</div>



                            </div>

                        </div>

                        <div class="post__content">
                            <p>I have recently built a Stack Overflow clone with Dgraph and React. I was delightfully surprised by the pleasant developer experience and the performance of my application. In this post, I would like to tell the story of how I built <em>Graphoverflow</em> and share the best practices I learned for using Dgraph to build a modern web application.</p>
<p>As you can see in the <a href="https://graphoverflow.dgraph.io">live demo</a>, <em>Graphoverflow</em> implements all core functionalities of Stack Overflow. Through the web interface, you can create, read, update, and delete questions, answers, comments. You can also cast upvotes and downvotes. In addition, it is smart enough to recommend you questions to read based on <a href="https://en.wikipedia.org/wiki/Collaborative_filtering">collaborative filtering</a>. In many ways, <em>Graphoverflow</em> successfully embodies many important features that most modern web applications depend on: CRUD operations, and user authentication and authorization. As <a href="https://github.com/dgraph-io/graphoverflow">the source code</a> shows, all this is achieved by using Dgraph as the primary and only data storage.</p>
<p>Looking back the past three weeks of building <em>Graphoverflow</em>, I feel that the journey was unexpectedly simple and straightforward. I have never built anything using a graph database in my entire life. Therefore when I started building this application I knew I was set out for a bumpy ride. However, the intuitive query language of Dgraph did the heavy lifting out of the box, and I did not have to struggle too much. <em>Graphoverflow</em> is not a simple application by any means, as it needs to retrieve and render a large amount of data with complex relationships, and has a built-in recommendation system. However, a quick analysis of the code base reveals that I only had to write 700 LOC (18%) on the server side, and 3300 LOC (82%) on the client side to ship it, excluding</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#998;font-style:italic"># Server side</span>
-------------------------------------------------------------------------------
Language                     files          blank        comment           code
-------------------------------------------------------------------------------
JavaScript                       <span style="color:#099">7</span>             <span style="color:#099">94</span>             <span style="color:#099">21</span>            <span style="color:#099">654</span>
JSON                             <span style="color:#099">1</span>              <span style="color:#099">0</span>              <span style="color:#099">0</span>             <span style="color:#099">39</span>
-------------------------------------------------------------------------------
SUM:                             <span style="color:#099">8</span>             <span style="color:#099">94</span>             <span style="color:#099">21</span>            <span style="color:#099">693</span>
-------------------------------------------------------------------------------


<span style="color:#998;font-style:italic"># Client side</span>
-------------------------------------------------------------------------------
Language                     files          blank        comment           code
-------------------------------------------------------------------------------
JavaScript                      <span style="color:#099">62</span>            <span style="color:#099">391</span>             <span style="color:#099">74</span>           <span style="color:#099">2880</span>
Sass                            <span style="color:#099">17</span>             <span style="color:#099">91</span>              <span style="color:#099">1</span>            <span style="color:#099">461</span>
-------------------------------------------------------------------------------
SUM:                            <span style="color:#099">79</span>            <span style="color:#099">482</span>             <span style="color:#099">75</span>           <span style="color:#099">3341</span>
-------------------------------------------------------------------------------
</code></pre></div><p>The simplicity of the code base clearly demonstrates that, with Dgraph, you can end up with a lot less complex application code for your non-trivial requirements.</p>
<h2 id="the-query-language-was-the-key">The Query Language Was The Key</h2>
<p>I believe that <em>Graphoverflow</em> owes its simple code base and the fast iteration cycle to Dgraph&rsquo;s homebred query language, <a href="https://docs.dgraph.io/query-language/"><em>Graphql+-</em></a>. To me, the biggest benefit of the query language was that I was able to retrieve complex data by writing a single, and intuitive tree-like structure. I could spend less time worrying about what tables to create or join together to store and fetch the data that the frontend required. Instead, I could simply focus on polishing my front-end components, while relying on Dgraph&rsquo;s flexible schema system and its powerful query language.</p>
<p><img src="https://blog.dgraph.io/images/graphoverflow-question.png" alt="GraphOverflow question"></p>
<p>The inner workings of the question page shown above can shed lights on Dgraph&rsquo;s ability to retrieve complex data in a straightforward way. In order to render this page on the front-end, I needed to fetch <code>question</code>, and all of its <code>answers</code>. For all of them, I needed to fetch the total number of <code>upvotes</code> and <code>downvotes</code>, <code>viewCounts</code>, its <code>history</code>, <code>comments</code>, and those comments&rsquo; respective <code>scores</code>. Not only that but also I needed to fetch 30 <code>related questions</code> based on the tags attached to the displayed question. These data have complex schemas and interdependent relationships with one another. The queries I wrote, on the other hand, felt very straightforward to me.</p>
<pre><code>{
  question(func: uid(0xa421) {
    Title {
      Text
    }
    Body {
      Text
    }
    ViewCount
    UpvoteCount: count(Upvote)
    DownvoteCount: count(Downvote)

    Comment {
      ...
    }

    Has.Answer {
      Comment {
        ...
      }
      ...
    }
    ...
  }
}
</code></pre><p>The above is the query responsible for fetching the <code>question</code>, its <code>answers</code>, and their relevant properties and children such as <code>comments</code>. GraphQL+- is comprised of the root node and its nested blocks, and when executed it returns a result in a subgraph format. A query can have multiple root nodes, and you can see the whole query <a href="https://github.com/dgraph-io/graphoverflow/blob/master/app/client/src/queries/Question.js#L131">here on GitHub</a>. In short, the above query returns a result shaped like the following code block. We can see that starting from the root node, <code>question</code>, Dgraph finds and returns all the children nodes represented by nested blocks.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">{
  <span style="color:#d14">&#34;question&#34;</span><span style="color:#000;font-weight:bold">:</span> [
    {
      <span style="color:#d14">&#34;Timestamp&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;2015-10-06T15:34:33.75Z&#34;</span>,
      <span style="color:#d14">&#34;Title&#34;</span><span style="color:#000;font-weight:bold">:</span> [
        {
          <span style="color:#d14">&#34;Text&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;How can I keep my cat off my keyboard?&#34;</span>
        }
      ]
      <span style="color:#d14">&#34;Body&#34;</span><span style="color:#000;font-weight:bold">:</span> [
        {
          <span style="color:#d14">&#34;Text&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;...&#34;</span>
        }
      ],
      <span style="color:#d14">&#34;ViewCount&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#099">21767</span>,
      <span style="color:#d14">&#34;UpvoteCount&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#099">169</span>,
      <span style="color:#d14">&#34;DownvoteCount&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#099">2</span>,
      <span style="color:#d14">&#34;Comment&#34;</span><span style="color:#000;font-weight:bold">:</span> [ { ... }, ... ],
      <span style="color:#d14">&#34;Has.Answer&#34;</span><span style="color:#000;font-weight:bold">:</span> [
        {
          <span style="color:#d14">&#34;Comment&#34;</span><span style="color:#000;font-weight:bold">:</span> [ { ... }, ... ],
          ...
        },
        ...
      ],
    }
  ]
}
</code></pre></div><p><strong>Warning</strong></p>
<p>Query syntax and features has changed in v1.0 release.
For the latest syntax and features, visit <a href="https://docs.dgraph.io">link to docs</a>.</p>
<h2 id="using-in-react">Using in React</h2>
<p>To query Dgraph and use the result in a React application, we can use the component lifecycle method provided by React. When a component responsible for displaying the question mounts to the DOM, <em>Graphoverflow</em> sends a query to Dgraph and displays a loading screen for a short while until the result arrives. Therefore, it handles the data fetching in the <a href="https://facebook.github.io/react/docs/react-component.html#componentdidmount"><code>compnentDidMount</code></a> lifecycle method which is invoked immediately after a component mounts. The simplified code looks like the following:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">import</span> React from <span style="color:#d14">&#39;react&#39;</span>;
<span style="color:#000;font-weight:bold">import</span> { runQuery } from <span style="color:#d14">&#34;../lib/helpers&#34;</span>;
<span style="color:#000;font-weight:bold">import</span> { getQuestionQuery } from <span style="color:#d14">&#34;../queries/Question&#34;</span>;

<span style="color:#000;font-weight:bold">class</span> Question <span style="color:#000;font-weight:bold">extends</span> React.Component {
  constructor(props) {
    <span style="color:#000;font-weight:bold">super</span>(props);

    <span style="color:#000;font-weight:bold">this</span>.state <span style="color:#000;font-weight:bold">=</span> {
      questionLoaded<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">false</span>,
      question<span style="color:#000;font-weight:bold">:</span> {}
    };
  }

  componentDidMount() {
    <span style="color:#000;font-weight:bold">const</span> questionUID <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.props.match.params.uid;
    <span style="color:#000;font-weight:bold">const</span> query <span style="color:#000;font-weight:bold">=</span> getQuestionQuery(questionUID);

    runQuery(query).then(res =&gt; {
      <span style="color:#000;font-weight:bold">const</span> question <span style="color:#000;font-weight:bold">=</span> res.question[<span style="color:#099">0</span>];
      <span style="color:#000;font-weight:bold">this</span>.setState({ question, questionsLoaded<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">true</span> });
    })
  }

  ...
}
</code></pre></div><p>Three things need to happen in <code>componentDidMount</code>: constructing a query for the question, sending the query to the server, storing the result so that it can be rendered. Let us look at this simple process step-by-step.</p>
<ul>
<li>
<p>Since we need to fetch a question with a specific <code>_uid_</code>, we need to dynamically make a query string by interpolating string. <code>getQuestionQuery</code> is a factory that takes a <code>questionUID</code> and returns a string representing the query.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">function</span> getQuestionQuery(questionUID) {
  <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">`
</span><span style="color:#d14">    question(func: uid(</span><span style="color:#d14">${</span>questionUID<span style="color:#d14">}</span><span style="color:#d14">)) {
</span><span style="color:#d14">      ...
</span><span style="color:#d14">    }
</span><span style="color:#d14">  `</span>;
}
</code></pre></div></li>
<li>
<p>Once we have the query, simply make an HTTP <code>POST</code> request to Dgraph server. <code>runQuery</code> is a helper method that returns a promise that resolves with the JSON response from Dgraph server. It uses <a href="https://github.com/visionmedia/superagent">superagent</a>, but you can surely use other solutions such as <a href="https://github.com/github/fetch">fetch</a>.</p>
</li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">import</span> request from <span style="color:#d14">&#34;superagent&#34;</span>;

<span style="color:#000;font-weight:bold">function</span> runQuery(queryText) {
  <span style="color:#000;font-weight:bold">const</span> endpointBaseURL <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;http://localhost:3030&#39;</span>;

  <span style="color:#000;font-weight:bold">return</span> request.post(<span style="color:#d14">`</span><span style="color:#d14">${</span>endpointBaseURL<span style="color:#d14">}</span><span style="color:#d14">/query`</span>).send(queryText).then(res =&gt; {
    <span style="color:#000;font-weight:bold">return</span> JSON.parse(res.text);
  });
}
</code></pre></div><ul>
<li>When we get the response, we store it in an application state so that the data can be rendered in the browser. <em>Graphoverflow</em> persists the data in component&rsquo;s state to keep the demonstration simple. However, you can easily integrate state management libraries such as <a href="https://github.com/reactjs/redux">Redux</a> or <a href="https://github.com/mobxjs/mobx">MobX</a> to this step.</li>
</ul>
<p>Having completed the above process in <code>componentDidMount</code>, now we can render the question page. Here is what <code>render</code> method of <code>Question</code> component looks like in a simplified way.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">render() {
  <span style="color:#000;font-weight:bold">const</span> {
    question,
    questionLoaded,
  } <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.state;

  <span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">!</span>questionLoaded) {
    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">&lt;</span>Loading <span style="color:#000;font-weight:bold">/&gt;</span>;
  }

  <span style="color:#000;font-weight:bold">return</span> (
    <span style="color:#000;font-weight:bold">&lt;</span>div<span style="color:#000;font-weight:bold">&gt;</span>
      <span style="color:#000;font-weight:bold">&lt;</span>QuestionLayout question<span style="color:#000;font-weight:bold">=</span>{question} <span style="color:#000;font-weight:bold">/&gt;</span>
    <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#a61717;background-color:#e3d2d2">/div&gt;</span>
  );
}
</code></pre></div><p>Once I got the hang of the query language, it felt very natural using Dgraph with React simply because there was nothing new or paradigm-shifting. The process described above is exactly how I would use PostgreSQL or MongoDB in a purely client-side rendered Single Page Application.</p>
<p>The mechanism described here can be adapted to support more advanced use cases such as server-side rendering; we can move the whole process into a static method of the component that returns a promise, and call it on the server side and delay the render until a response is fetched and promise resolved. We can even integrate Redux with ease so that the app state can be rehydrated on the client side.</p>
<h2 id="best-practices">Best Practices</h2>
<p>Through building <em>Graphoverflow</em>, I have come up with some practices that I believe will help keep your code base maintainable and save time. Those are based on my collective lessons from numerous trial, errors, and redesign attempts. Often a lack of documented practices is the biggest barrier hindering us from dipping our unfamiliar technologies and cultivating their benefits. The following practices will help you instantly get started with building fast modern web applications with Dgraph and React.</p>
<h3 id="organize-your-queries-along-with-your-components">Organize Your Queries Along With Your Components</h3>
<p>It is a good idea to couple together a component and all queries that component relies on for data. The reason is that you need to know the shape of JSON response from Dgraph server in order to render your components. And the shape of the response can vary for mainly two reasons. Names of predicates can change because a query can use an <a href="https://docs.dgraph.io/query-language/#alias">alias</a>. Alternatively, a nested block in a query might be omitted either by need or an error. Those situations can suddenly take away fields that your React component assumes are present. If you have a chain of attribute getters and one of those attributes is missing, you will end up chaining a getter on an <code>undefined</code>. Prior to React 16, such scenario can <a href="https://facebook.github.io/react/blog/2017/07/26/error-handling-in-react-16.html#behavior-in-react-15-and-earlier">lead to cryptic error messages</a> that are hard to debug.</p>
<p>Here is an example of how a change in Dgraph response can cause an error in your React application. The query for the question page includes the following:</p>
<pre><code>{
  question(func: uid(0xa421) {
    Title {
      Text
    }
    ...
  }
}
</code></pre><p>In the <code>Question</code> component, <em>Graphoverflow</em> renders the title while assuming the result has the shape of <code>{ question: { title: [ { text } ], ... } }</code>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">class</span> Question <span style="color:#000;font-weight:bold">extends</span> React.Component {
  ...
  render() {
    ...

    <span style="color:#000;font-weight:bold">return</span> (
      ...
      <span style="color:#000;font-weight:bold">&lt;</span>h1 className<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;post-title&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>{post.Title[<span style="color:#099">0</span>].Text}<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#a61717;background-color:#e3d2d2">/h1&gt;</span>
      ...
    );
  }
}
</code></pre></div><p>If we change the query to the following, the component will not work anymore because <code>post.Title</code> will be <code>undefined</code>.</p>
<pre><code>{
  question(func: uid(0xa421) {
    question_title as Title {
      Text
    }
    ...
  }
}
</code></pre><p>Your queries will evolve as your requirements change. Iterating on your query can be error-prone if the queries are scattered in a random manner without a formal structure. Therefore I recommend the following directory structure in your project to mitigate such issue and keep your code base maintainable.</p>
<pre><code>your_project
├── components
│   ├── EditPost.js
│   ├── Home.js
│   └── Question.js
├── queries
│   ├── EditPost.js
│   ├── Home.js
│   └── Question.js
...
</code></pre><p>Within your component, import needed queries from the corresponding query file. This way, we can easily iterate on queries for your components in a reliable manner. It is clean and reassuring to have a separate, go-to file to see all the queries that your component is relying on. It keeps possible errors in check and makes debugging feasible in case of an error.</p>
<h3 id="use-functions-to-dynamically-construct-queries">Use Functions to Dynamically Construct Queries</h3>
<p>When your query needs to be built dynamically, write a function that takes values and returns a query string using those values. In other words, make a factory to dynamically generate queries rather than doing string interpolation directly in your component. Previously we have seen an example of such function that generates a query for a specific question:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">function</span> getQuestionQuery(questionUID) {
  <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">`
</span><span style="color:#d14">    question(func: uid(</span><span style="color:#d14">${</span>questionUID<span style="color:#d14">}</span><span style="color:#d14">)) {
</span><span style="color:#d14">      ...
</span><span style="color:#d14">    }
</span><span style="color:#d14">  `</span>;
}
</code></pre></div><p>Many occasions will arise in which you need to generate a query dynamically. Most common cases are fetching a single resource by its unique identifier, or posting information while performing <a href="https://docs.dgraph.io/query-language/#mutations">mutations</a>. In such occasions, simply export functions like the example above from the appropriate query file that you have established following the previous best practice. Doing so allows you to keep all the queries in a single file in a clean way.</p>
<h3 id="use-fragments-for-repeated-structures">Use Fragments for Repeated Structures</h3>
<p>If queries for one of your components exhibits repeated structures, consider extracting them as fragments that can be reused. Doing so will allow us to avoid the mismatch between the shape of Dgraph response and your React component&rsquo;s expectation of it, a common pitfall that we already identified above.</p>
<p><img src="https://blog.dgraph.io/images/graphoverflow-homepage.png" alt="GraphOverflow homepage"></p>
<p>As we can see from the picture, the <code>Home</code> component of <em>Graphoverflow</em> can fetch questions according to three different criteria: &lsquo;Recommended&rsquo;, &lsquo;Most Recent&rsquo;, and &lsquo;Hot&rsquo;. While these criteria fetch questions of different ilks, the returned fields for the questions must be consistent because a single React component is responsible for rendering a question item, no matter what criteria is used to fetch them.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">import</span> React from <span style="color:#d14">&#34;react&#34;</span>;

<span style="color:#000;font-weight:bold">const</span> QuestionItem <span style="color:#000;font-weight:bold">=</span> ({ question, history }) =&gt; {
  <span style="color:#000;font-weight:bold">return</span> (
    <span style="color:#000;font-weight:bold">&lt;</span>li<span style="color:#000;font-weight:bold">&gt;</span>
      ...
      {question.AnswerCount}
      ...
      {question.ViewCount}
      ...
      <span style="color:#000;font-weight:bold">&lt;</span>Link to<span style="color:#000;font-weight:bold">=</span>{questionLink} className<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;question-title&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
        {JSON.stringify(question.Title[<span style="color:#099">0</span>].Text)}
      <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#a61717;background-color:#e3d2d2">/Link&gt;</span>
    <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#a61717;background-color:#e3d2d2">/li&gt;</span>
  );
}
</code></pre></div><p>There are three different queries in <code>queries/Home.js</code>, all fetching data required for rendering <code>QuestionItem</code> while following different criteria.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">export</span> <span style="color:#000;font-weight:bold">const</span> recommendedQuestionQuery <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">`{
</span><span style="color:#d14">  ...
</span><span style="color:#d14">  questions(...) {
</span><span style="color:#d14">    _uid_
</span><span style="color:#d14">    Title {
</span><span style="color:#d14">      Text
</span><span style="color:#d14">    }
</span><span style="color:#d14">    ...
</span><span style="color:#d14">  }
</span><span style="color:#d14">}`</span>;
<span style="color:#000;font-weight:bold">export</span> <span style="color:#000;font-weight:bold">const</span> hotQuestionQuery <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">`{
</span><span style="color:#d14">  ...
</span><span style="color:#d14">  questions(...) {
</span><span style="color:#d14">    _uid_
</span><span style="color:#d14">    Title {
</span><span style="color:#d14">      Text
</span><span style="color:#d14">    }
</span><span style="color:#d14">    ...
</span><span style="color:#d14">  }
</span><span style="color:#d14">}`</span>;
<span style="color:#000;font-weight:bold">export</span> <span style="color:#000;font-weight:bold">const</span> recentQuestionQuery <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">`{
</span><span style="color:#d14">  ...
</span><span style="color:#d14">  questions(...) {
</span><span style="color:#d14">    _uid_
</span><span style="color:#d14">    Title {
</span><span style="color:#d14">      Text
</span><span style="color:#d14">    }
</span><span style="color:#d14">    ...
</span><span style="color:#d14">  }
</span><span style="color:#d14">}`</span>;
</code></pre></div><p>If we happen to under-fetch a field for <code>questions</code> in one of these queries, the data for our React component will be incomplete, causing run-time errors. Therefore, it is much more sensible to abstract out the common parts as a &lsquo;fragment.&rsquo; Doing so can eliminate the chance of errors in the future iterations.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">const</span> questionFragment <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">`
</span><span style="color:#d14">_uid_
</span><span style="color:#d14">Title {
</span><span style="color:#d14">  Text
</span><span style="color:#d14">}
</span><span style="color:#d14">...
</span><span style="color:#d14">`</span>;
<span style="color:#000;font-weight:bold">export</span> <span style="color:#000;font-weight:bold">const</span> recommendedQuestionQuery <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">`{
</span><span style="color:#d14">  ...
</span><span style="color:#d14">  questions(...) {
</span><span style="color:#d14">    </span><span style="color:#d14">${</span>questionFragment<span style="color:#d14">}</span><span style="color:#d14">
</span><span style="color:#d14">  }
</span><span style="color:#d14">}`</span>;
<span style="color:#000;font-weight:bold">export</span> <span style="color:#000;font-weight:bold">const</span> hotQuestionQuery <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">`{
</span><span style="color:#d14">  ...
</span><span style="color:#d14">  questions(...) {
</span><span style="color:#d14">    </span><span style="color:#d14">${</span>questionFragment<span style="color:#d14">}</span><span style="color:#d14">
</span><span style="color:#d14">  }
</span><span style="color:#d14">}`</span>;
<span style="color:#000;font-weight:bold">export</span> <span style="color:#000;font-weight:bold">const</span> recentQuestionQuery <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">`{
</span><span style="color:#d14">  ...
</span><span style="color:#d14">  questions(...) {
</span><span style="color:#d14">    </span><span style="color:#d14">${</span>questionFragment<span style="color:#d14">}</span><span style="color:#d14">
</span><span style="color:#d14">  }
</span><span style="color:#d14">}`</span>;
</code></pre></div><h2 id="conclusion">Conclusion</h2>
<p>Building an application with Dgraph left me with a strange aftertaste. Usually, a new technology inevitably leaves a feeling of ennui, after the excitement of trying out something new eventually subsides. Yet this time, I felt something quite different. Perhaps it was a taste of delight, a hint at something exciting in the making.</p>
<p>As a young developer, I often find myself in a vain pursuit of the newest and the shiniest piece of technology. In that hedonistic treadmill, I time and again stumbled upon many burgeoning technologies proclaiming to be the fastest, the newest, the most game-changing. Perhaps all those claims are justified in their own unique ways, but for the most part, it feels that they are merely clamoring for attention. In contrast, Dgraph seems to make a persuasive case with its well-designed query language alone.</p>
<p>Dgraph has proven to work seamlessly with React, and its rich and intuitive query language allowed me to make and ship a Stack Overflow clone in a matter of weeks without a previous experience. The ease of iteration, coupled with the performance, indicates that Dgraph is a valuable addition to our tool belts for building modern web applications.</p>


<aside class="post__references">

    <h4>References</h4><p>You can try Graphoverflow on <a href="https://graphoverflow.dgraph.io">https://graphoverflow.dgraph.io</a> and view its source code on <a href="https://github.com/dgraph-io/graphoverflow">https://github.com/dgraph-io/graphoverflow</a>.</p>
<p>Top image: <a href="https://images.nasa.gov/#/details-iss042e021664.html">International Space Station Night Europe</a></p>
</aside>
                        </div>

                        
    <aside class="post__authors">
                <div class="tile author-tile">

    <img src="https://blog.dgraph.io/images/people/sung.jpg" class="author-tile__photo">

    <h4 class="author-tile__title">
        <a href="https://blog.dgraph.io/authors/sung/">Sung Won Cho</a>,
        Author
    </h4>

    <p>Sung makes products used by thousands of people. He is a frontend developer at
Dgraph. To his dismay, years of trying to become a famous musician did not pan
out.</p>


    
        <nav class="author-tile__social">

            
                <a href="https://www.linkedin.com/in/sungwoncho/" target="_blank">
                    <i class="fab fa-linkedin"></i>
                </a>
            

            
                <a href="https://twitter.com/mikeswcho" target="_blank">
                    <i class="fab fa-twitter"></i>
                </a>
            

            
                <a href="https://github.com/sungwoncho" target="_blank">
                    <i class="fab fa-github"></i>
                </a>
            

        </nav>
    

</div>

            
        

    </aside>



                        <div class="post__comments">

    <div id="discourse-comments"></div>

    
    <script type="text/javascript">
        DiscourseEmbed = {
            discourseUrl: "https:\/\/discuss.dgraph.io\/",
            topicId:  1689 
            };
        (function() {
            var d = document.createElement("script");
            d.type = "text/javascript";
            d.async = true;
            d.src = DiscourseEmbed.discourseUrl + "javascripts/embed.js";
            (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(d);
        })();
    </script>
    <noscript>Please enable JavaScript to view the comments on <a href="https://discuss.dgraph.io/">discuss</a>.</noscript>
    

</div>


                        <div class="modal fade" id="runnable-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <a href="#" data-dismiss="modal" class="modal-close-btn">
    Close
  </a>

  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-body">

      </div>
    </div>
  </div>
</div>

                    </div>
                </div>

                <div class="col-12 col-md-4 col-lg-3 offset-lg-1">
                    <div class="page-body__sidebar">

                        






                        


                        <aside class="post__cta">

    <h3>
        Deploy Dgraph<br>
        in Minutes
    </h3>

    <p>Dgraph does more than just simplify your workload. Discover what makes Dgraph GraphQL the best option for the job.</p>

    <a href="https://dgraph.io/downloads" class="button button--secondary">
        <span>Download</span>
        <i class=" fas fa-arrow-right"></i>
    </a>

</aside>


                    </div>
                </div>

            </div>
        </div>
    </section>

    <footer class="page-footer">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-5 col-sm-4">
        <div class="row">
          <div class="col-12 col-md-6 page-footer__nav">
            <h3 class="zeta">Products</h3>
            <ul>
              <li><a href="https://dgraph.io/graphql">GraphQL</a></li>
              <li><a href="https://dgraph.io/enterprise">Enterprise</a></li>
              <li><a href="https://dgraph.io/downloads">Downloads</a></li>
            </ul>
          </div>
          <div class="col-12 col-md-6 page-footer__nav">
            <h3 class="zeta">Learn</h3>
            <ul>
              <li><a href="https://dgraph.io/blog" target="_blank">Blog</a></li>
              <li><a href="https://tour.dgraph.io" target="_blank">Interactive Tour</a></li>
              <li><a href="https://discuss.dgraph.io" target="_blank">Forum</a></li>
              <li><a href="https://slack.dgraph.io" target="_blank">Slack</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-5 col-sm-4">
        <div class="row">
          <div class="col-12 col-md-6 page-footer__nav">
            <h3 class="zeta">Docs</h3>
            <ul>
              <li><a href="https://docs.dgraph.io" target="_blank">Dgraph Docs</a></li>
              <li><a href="https://graphql.dgraph.io/docs/" target="_blank">GraphQL Docs</a></li>
            </ul>
          </div>
          <div class="col-12 col-md-6 page-footer__nav">
            <h3 class="zeta">Company</h3>
            <ul>
              <li><a href="https://dgraph.io/about">Team</a></li>
              <li><a href="https://dgraph.io/careers">Careers</a></li>
              <li><a href="https://dgraph.io/contact">Contact</a></li>
              <li><a href="https://dgraph.io/conduct">Conduct</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-12 col-sm-6 col-md-4 col-lg-3 offset-lg-1 border-above-sm">
        <div class="page-footer__cta"><a href="https://dgraph.io/downloads" title="Download" class="button button--secondary"><span>Download</span><i class="fas fa-arrow-right"></i></a></div>
        <div class="page-footer__address">
          <p>
            655 Montgomery Street, 7th Floor<br>
            San Francisco, CA 94111
          </p>
          <hr>
          <p><a href="mailto:contact@dgraph.io">contact@dgraph.io</a></p>
        </div>
      </div>
    </div>
    <div class="page-footer__social">
      <ul>
        <li><a href="https://twitter.com/dgraphlabs" target="_blank"><i class="fab fa-twitter"></i></a></li>
        <li><a href="https://github.com/dgraph-io/dgraph" target="_blank"><i class="fab fa-github"></i></a></li>
        <li><a href="https://www.youtube.com/channel/UCghE41LR8nkKFlR3IFTRO4w" target="_blank"><i class="fab fa-youtube"></i></a></li>
        <li><a href="https://slack.dgraph.io" target="_blank"><i class="fab fa-slack"></i></a></li>
        <li><a href="https://www.linkedin.com/company/dgraph-labs" target="_blank"><i class="fab fa-linkedin"></i></a></li>
      </ul>
    </div>
    <div class="page-footer__copyright">
      <p>
        <Copyright>&copy; 2017-2020 Dgraph Labs, Inc.</Copyright>
      </p>
    </div>
  </div>
</footer>

    <script src="https://blog.dgraph.io//js/clipboard.min.js"></script>
    <script
      src='https://blog.dgraph.io//js/runnable.js?29f8ba4fb8d90804cf24ff53b70192ad'
    ></script>
    <script>
      hljs.initHighlightingOnLoad();
    </script>




<script>
  window.Countly = window.Countly || {};
  Countly.q = Countly.q || [];

  Countly.q.push(['track_sessions']);
  Countly.q.push(['track_pageview']);
  (function() {
  	var cly = document.createElement('script');
  	cly.type = 'text/javascript';
  	cly.async = true;
  	cly.src = "https://dgraph.io/assets/js/unminified/stats/dgraph-stats.min.js";
  	cly.onload = function() {
      Countly.init({
        app_key: "e93284ab5e5d21ef9eb16a94516b3c1c6eba1015",
        url: "https://stats.dgraph.io",
        force_post: true,
      })
  	};
  	document.body.appendChild(cly);
  })();
</script>


<script>
$(document.links)
  .filter(function() {
    return this.hostname != window.location.hostname;
  })
  .attr("target", "_blank");
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/visibility.js/1.2.4/visibility.min.js"></script>
<link href="https://fonts.googleapis.com/css?family=Indie+Flower" rel="stylesheet">
<link
  href='https://blog.dgraph.io//css/heart.css?24a50879951b2391f04750723b4a012e'
  rel="stylesheet">
<link
  href='https://blog.dgraph.io//css/github-engage.css?d60d80bf2b6a24350cdb5d834ab47e27'
  rel="stylesheet">

<script
  src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.min.js"
  integrity="sha256-7/yoZS3548fXSRXqc/xYzjsmuW3sFKzuvOCHd06Pmps="
  crossorigin="anonymous"
></script>
<script
  type="text/javascript"
  src='https://blog.dgraph.io//js/custom.js?94f0c667422b8dac293e14c9c49872e3'
></script>

<script src="//unpkg.com/@dgraph-io/community"></script>


</body>

    <script src="https://blog.dgraph.io/js/footnotes.js"></script>

</html>

