<!DOCTYPE html>

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1">
  <link rel="canonical" href="https://blog.dgraph.io/post/alice/" />


  <link rel="apple-touch-icon" sizes="57x57" href="https://dgraph.io/assets/images/favicons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="https://dgraph.io/assets/images/favicons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="https://dgraph.io/assets/images/favicons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="https://dgraph.io/assets/images/favicons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="https://dgraph.io/assets/images/favicons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="https://dgraph.io/assets/images/favicons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="https://dgraph.io/assets/images/favicons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="https://dgraph.io/assets/images/favicons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://dgraph.io/assets/images/favicons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"
    href="https://dgraph.io/assets/images/favicons/android-icon-192x192.png">
  <link rel="manifest" href="https://dgraph.io/assets/images/favicons/manifest.json">
  <link rel="icon" type="image/png" sizes="32x32" href="https://dgraph.io/assets/images/favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="https://dgraph.io/assets/images/favicons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://dgraph.io/assets/images/faviconsfavicon-16x16.png">
  <link rel="shortcut icon" href="https://dgraph.io/assets/images/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="https://dgraph.io/assets/images/faviconsms-icon-144x144.png">
  <meta name="msapplication-config" content="https://dgraph.io/assets/favicons/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://blog.dgraph.io//index.xml">
  
  <title>Making Badger Crash Resilient with ALICE - Dgraph Blog</title>
  <meta property='og:title' content="Making Badger Crash Resilient with ALICE - Dgraph Blog">
  <meta property="og:type" content="article">
  

  <meta property="og:url" content="https://blog.dgraph.io/post/alice/">
  
  
  <meta property="og:image" content="https://blog.dgraph.io//images/galileo-jupiter.jpg">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"
    integrity="sha256-0rguYS0qgS6L4qVzANq4kjxPLtvnp5nn2nB5G1lWRv4=" crossorigin="anonymous"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/styles/default.min.css" rel="stylesheet"
    integrity="sha256-Zd1icfZ72UBmsId/mUcagrmN7IN5Qkrvh75ICHIQVTk=" crossorigin="anonymous" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js"
    integrity="sha256-sNPiigbfSkqUzMc5rgrdztLnneCMAp6W9wetJUZu9Zw=" crossorigin="anonymous"></script>
  <link
    href='https://blog.dgraph.io//css/runnable.css?7bbf71b4888bc97241e85bc7326a12fe'
    rel="stylesheet" />
  
  <link
    href='https://blog.dgraph.io//css/runnable-custom.css?74110b504a7b8a6e92a95279cfa96032'
    rel="stylesheet" />

  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Mono:wght@400;500&display=swap" />

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />

  <link href="https://dgraph.io/assets/css/style.min.css?06052020-1" rel="stylesheet" type="text/css" />

  <link href="https://dgraph.io/assets/css/font-awesome/css/all.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Merriweather+Sans:ital@1&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700&display=swap" rel="stylesheet">


  <script src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
    integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
    integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/codemirror.js"
    integrity="sha256-x3BtPVERvw1ozPlwivuFLZoViFCeAAs1Gt6SxEedmo8=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/codemirror.css"
    integrity="sha256-7sZe9dsqyNZC9Mk+WPRB7nVvPPPXyorzm2QKqlgXC4k=" crossorigin="anonymous" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/addon/edit/closebrackets.min.js"
    integrity="sha256-qhu2a7DSpQaammMaLw1iruxBpxmgdw8mdQaQWQUokcY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/mode/javascript/javascript.min.js"
    integrity="sha256-7Bdg/UdDMmHDPafpQDYZNPCEbnRP7eAvu+2hEoqRCXs=" crossorigin="anonymous"></script>
  

  <script src="https://cdn.jsdelivr.net/npm/algoliasearch@3/dist/algoliasearch.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.0.0/dist/instantsearch.production.min.js"
    integrity="sha256-6S7q0JJs/Kx4kb/fv0oMjS855QTz5Rc2hh9AkIUjUsk=" crossorigin="anonymous"></script>
  <script src="https://blog.dgraph.io//js/search.js?04292020"></script>
  <script>

    $(".subscribe-box").hide();
    $(window).scroll(function () {
      if ($(window).scrollTop() > 400) {
        $(".subscribe-box").fadeIn("fast");
      }
      else {
        $(".subscribe-box").fadeOut("fast");
      }
    });
   
    
    
    $(window).scroll(function () {
      if ($(window).scrollTop() > 180) {
        $("#page-header").addClass("bg-white");
      }
      else {
        $("#page-header").removeClass("bg-white");
      }
    });

    $(document).scroll(function () {
      checkOffset();
    });

   
    function checkOffset() {
      var x = $(".container").offset();
        var leftPosition = x.left + 75;
      if ($('.subscribe-box').offset().top + $('.subscribe-box').height()
        >= $('.bottom-section').offset().top - 10){
        $('.subscribe-box').addClass('footer-before');
        $('.footer-before').css('left',  -leftPosition  );
        }
      if ($(document).scrollTop() + window.innerHeight < $('.bottom-section').offset().top){
        $('.subscribe-box').removeClass('footer-before');
        $('.subscribe-box').css('left',  '30px' );
      }
         
    }
    $(document).ready(function () {
      $( ".page-search" ).wrapInner( "<div class='wrapper'></div>")
      $('.wrapper').after($('.page-search__results'))

      $(".subscribe-box-mobi .click-btn").click(function () {
        $(".subscribe-box").toggleClass("open");
        $(".subscribe-box-mobi").toggleClass('hide');
      });
      $(".subscribe-box .close").click(function () {
        $(".subscribe-box").toggleClass("open");
        $(".subscribe-box-mobi").toggleClass('hide');
      });
      $('.nav-icon').click(function() {
	    $('.page-nav').toggleClass('shownav');
	    $(this).toggleClass('active');
  });
  var $nav = document.querySelector('.page-nav > ul');
	var $navItems = document.querySelectorAll('.page-nav > ul > li');
	var $navItemHeading = document.querySelectorAll('.page-nav > ul > li > div');
  var $subnav = document.querySelectorAll('.page-nav > ul > li > ul');
  $($navItemHeading).click(function(e) {
	    $($navItems).removeClass('active');
	    $(this).parent().toggleClass('active');
	});
  $('.nav-icon[target="_blank"]').removeAttr('target');
  
    });
  </script>

  
  
  
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:image" content="https://blog.dgraph.io//images/galileo-jupiter.jpg" />
  
  

  <meta name="twitter:title" content="Making Badger Crash Resilient with ALICE" />
  <meta name="twitter:description"
    content="Crashes can occur for many different reasons and can manifest themselves in many different forms. A program can experience a segfault or uncaught exception." />
  
  <meta name="twitter:site" content="@dgraphlabs" />

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-666192333"></script>
  <script>window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'AW-666192333');</script>
</head>
<body class="blog-single has-lightning" data-gr-c-s-loaded="true">
   <header id="page-header" class="page-header">
	<div class="page-logo">
		<a href="https://dgraph.io/">
			<img src="https://dgraph.io/assets/images/logo.svg">
		</a>
		<a href="javascript:;" class="nav-icon" >
			<div class="hamburger">
				<div class="line line-1"></div>
				<div class="line line-2"></div>
				<div class="line line-3"></div>
			</div>
		</a>
	</div>
	<nav class="page-nav">
    <ul>
        <li>
            <div data-label="Products">
                <span>Products</span>
            </div>
            <ul>
                <li>
                    <a href="https://dgraph.io/graphql" data-label="GraphQL">
                        <span>GraphQL</span>
                    </a>
                </li>
                <li>
                    <a href="https://dgraph.io/enterprise" data-label="Enterprise">
                        <span>Enterprise</span>
                    </a>
                </li>
                <li>
                    <a href="https://dgraph.io/downloads" data-label="Downloads">
                        <span>Downloads</span>
                    </a>
                </li>
                <li>
                    <a href="https://dgraph.io/badger" data-label="Badger">
                        <span>Badger</span>
                    </a>
                </li>
                <li>
                    <a href="https://dgraph.io/compare-features" data-label="Compare Features">
                        <span>Compare Features</span>
                    </a>
                </li>
            </ul>
        </li>
        <li>
            <div data-label="Learn" class="is-active">
                <span>Learn</span>
            </div>
            <ul>
                <li>
                    <a href="https://dgraph.io/blog" data-label="Blog">
                        <span>Blog</span>
                    </a>
                </li>
                <li>
                    <a href="https://tour.dgraph.io" target="_blank" data-label="Interactive Tour">
                        <span>Interactive Tour</span>
                    </a>
                </li>
                <li>
                    <a href="https://discuss.dgraph.io" target="_blank" data-label="Forum">
                        <span>Forum</span>
                    </a>
                </li>
                <li>
                    <a href="https://slack.dgraph.io" target="_blank" data-label="Slack">
                        <span>Slack</span>
                    </a>
                </li>
                <li>
                    <a href="https://dgraph.io/paper" target="_blank" data-label="Paper">
                        <span>Paper</span>
                    </a>
                </li>
            </ul>
        </li>
        <li>
            <div data-label="Docs"><span>Docs</span></div>
            <ul>
                <li>
                    <a href="https://docs.dgraph.io" target="_blank" data-label="Dgraph Docs">
                        <span>Dgraph Docs</span>
                    </a>
                </li>
                <li>
                    <a href="https://graphql.dgraph.io/docs/" target="_blank" data-label="GraphQL Docs">
                        <span>GraphQL Docs</span>
                    </a>
                </li>
            </ul>
        </li>
        <li>
            <div data-label="Company"><span>Company</span></div>
            <ul>
                <li>
                    <a href="https://dgraph.io/about" data-label="Team">
                        <span>Team</span>
                    </a>
                </li>
                <li>
                    <a href="https://dgraph.io/careers" data-label="Careers">
                        <span>Careers</span>
                    </a>
                </li>
                <li>
                    <a href="https://dgraph.io/contact" data-label="Contact">
                        <span>Contact</span>
                    </a>
                </li>
                <li>
                    <a href="https://dgraph.io/conduct" data-label="Conduct">
                        <span>Conduct</span>
                    </a>
                </li>
            </ul>
        </li>
    </ul>
</nav>

	<div class="page-cta">
    <ul>
        <li class="hide-tablet">
            <a href="https://dgraph.io/contact" title="Contact">Contact</a>
        </li>
        <li>
            <a href="https://dgraph.io/downloads" title="Download" class="button button--secondary">
                <span>Download</span>
                <i class="fas fa-arrow-right"></i>
            </a>
        </li>
    </ul>
</div>

</header>


   <section class="page-body">
      <div class="page-body__content">
         <div class="container">
            <div class="row justify-content-center">
               <div class="col-10 ">
                  <div class="page-search form-group has-search">
	<span class="fas fa-search form-control-feedback"></span>
	
</div>
               </div>
            </div>
         </div>
      </div>
      <div class="container">
         <div class="row justify-content-center">
            <div class="col-10 ">
               <div class="">
                  <div class="post__meta">
                     <div class="post__date">

    
        Mon, Aug 14, 2017
    
    
</div>

                     <div class="post__share">
                        
                        <a href="https://twitter.com/share?text=Making%20Badger%20Crash%20Resilient%20with%20ALICE&amp;url=https%3a%2f%2fblog.dgraph.io%2fpost%2falice%2f&amp;via=dgraphlabs"
                           target="_blank">
                        <i class="fab fa-twitter"></i>
                        </a>
                        
                     </div>
                  </div>
                  <div class="post__cover">
                     <img
                        src="https://blog.dgraph.io//images/galileo-jupiter.jpg">
                     <div class="post__header">
                        <h1 class="post__title">
                           Making Badger Crash Resilient with ALICE
                        </h1>
                        
<div class="post__byline">

    
            by <a href="https://blog.dgraph.io/authors/peter/">Peter Stace</a>
        
    

</div>


                     </div>
                  </div>
                  <div
                     class="post__content inner-content lg-pl-80 lg-pr-80 md-pl-50 md-pr-50 xs-pl-30 xs-pr-30 clearfix">
                     

<p>Crashes can occur for many different reasons and can manifest themselves in
many different forms. A program can experience a segfault or uncaught
exception.  If it&rsquo;s running on Linux, a kernel panic could occur.  If on
Windows, a STOP error could occur, displaying the infamous
<a href="https://en.wikipedia.org/wiki/Blue_Screen_of_Death">BSOD</a>.  Even then, crashes
aren&rsquo;t the only thing you have to worry about. The UPS could fail (or be
absent), or the power could go out.  Someone could be walking through the data
center and trip over a power cord.  In short, any program can terminate
prematurely and unexpectedly.</p>

<p>When a database crashes, what happens to your data? If your database has a high
level of crash resilience, your data is safe. The database can be started up
again, and you&rsquo;re pretty much good to go. You might have to rerun the last few
mutations you made before the crash, but for the most part, your data is still
intact. But what about databases with low levels of crash resilience? I <em>hope</em>
you make regular backups, because your database might not even start up.</p>

<p>At Dgraph Labs, current efforts are being spent ramping up towards a 1.0
version of our flagship product, <a href="https://github.com/dgraph-io/dgraph">Dgraph</a>.
<a href="https://github.com/dgraph-io/dgraph">Dgraph</a> is already very stable, but we
want to go the extra mile and make it robust and rock solid, even under rare
and unlikely scenarios.</p>

<p><a href="https://github.com/dgraph-io/dgraph">Dgraph</a> relies on
<a href="https://github.com/dgraph-io/badger">Badger</a> (our key value store) to persist
its data. This is an obvious place to look when it comes to making the whole
system resilient against crashes.  This blog post will explore the area of
crash resilience. It will look at a tool called ALICE, and how we used it to
improve the crash resilience of <a href="https://github.com/dgraph-io/badger">Badger</a>.</p>

<h2 id="background-and-motivation">Background and Motivation</h2>

<p><a href="https://github.com/dgraph-io/badger">Badger</a> contains a write ahead value log,
which is replayed when <a href="https://github.com/dgraph-io/badger">Badger</a> starts up.
You can read more about the internals of
<a href="https://github.com/dgraph-io/badger">Badger</a>
<a href="https://open.dgraph.io/post/badger/">here</a>.</p>

<p>The design of <a href="https://github.com/dgraph-io/badger">Badger</a> is based on a paper
titled <a href="https://www.usenix.org/system/files/conference/fast16/fast16-papers-lu.pdf">WiscKey: Separating Keys from Values in SSD-conscious
Storage</a>.
This paper discusses a property of modern file systems that aids in creating
crash resilient systems:</p>

<p><em>[There is] an interesting property of modern file systems (such as ext4,
btrfs, and xfs). &hellip;  Consider a file that contains [a] sequence of bytes &hellip;
and the user appends &hellip; to it. If a crash happens, &hellip; only some prefix of the
appended bytes will be added to the end of the file. &hellip; It is not possible for
random bytes or a non-prefix subset of the appended bytes to be added to the
file.</em></p>

<p>We wanted to use this interesting file system property to improve
<a href="https://github.com/dgraph-io/badger">Badger</a>.  Specifically, to increase the
crash resilience of the value log.</p>

<p>We decided to add an entry checksum to each value log entry. The idea was that
this would enable us to detect short appends during log file replay so that we
could truncate the value log at the end of the last good entry and continue
with the normal start up procedure.</p>

<p>This task was one of the <a href="https://github.com/dgraph-io/badger/pull/148">first things that I worked
on</a> when I started at Dgraph Labs
a couple of weeks ago.</p>

<h2 id="enter-alice">Enter ALICE</h2>

<p>After adding checksums to <a href="https://github.com/dgraph-io/badger">Badger</a>, I
started looking at papers from the same authors as the WiscKey paper. I came a
cross a paper titled <a href="http://research.cs.wisc.edu/adsl/Publications/alice-osdi14.pdf">All File Systems Are Not Created Equal</a>: On the Complexity
of Crafting Crash-Consistent
Applications.
This paper describes a <a href="https://github.com/madthanu/alice">tool called ALICE</a>
(Application-Level Intelligent Crash Explorer), written by the authors.  ALICE
discovers crash vulnerabilities in programs. A crash vulnerability is a bug in a
program that manifests itself when the program starts up after a system crash.
The main use of ALICE is to help programmers make their programs more robust and
resilient to crashes. ALICE will be explained in greater detail later in this
blog post.</p>

<p>ALICE helped identify two different crash vulnerabilities in
<a href="https://github.com/dgraph-io/badger">Badger</a> and even hinted towards how those
vulnerabilities could be fixed. Despite having minimal experience with the
<a href="https://github.com/dgraph-io/badger">Badger</a> code base, I was able to identify
and implement those fixes.  This is a testament to the usefulness of ALICE as a
tool (although the simplicity of the
<a href="https://github.com/dgraph-io/badger">Badger</a> codebase helped a lot here!).</p>

<p>I learned a lot about file systems and Linux system calls while working with
ALICE. Some things I already intuitively knew, but other things were totally
surprising.</p>

<h2 id="what-could-go-wrong-when-you-modify-a-file">What could go wrong when you modify a file?</h2>

<p>Say you have a file named <code>f</code> on disk. It contains the sequence of bytes <code>ABC</code>.</p>

<p>You then have a C program that operates on the file. The intent of the file is
to change the content to <code>12345</code>. The program isn&rsquo;t crash resilient though;
under certain crash scenarios, the file could end up having content <em>other</em>
than <code>ABC</code> or <code>12345</code>.</p>

<pre><code>01 int fd = open(&quot;f&quot;, O_RDWR | O_TRUNC, 0644);
02 write(fd, &quot;12345&quot;, 5);
03 close(fd);
# Boilerplate and error checking left out for brevity.
</code></pre>

<p>So if the program crashes part way through, what possible states could the file
<code>f</code> be in? For each of the following possible states, think about whether the
state is possible or not.</p>

<ol>
<li><code>f</code> contains <code>ABC</code>.</li>
<li><code>f</code> contains <code>12345</code>.</li>
<li><code>f</code> is now empty.</li>
<li><code>f</code> is missing from disk.</li>
<li><code>f</code> contains <code>123</code>.</li>
<li><code>f</code> contains <code>ABC$9</code>.</li>
</ol>

<p><strong>Take a few seconds and think about the possible states before reading on.</strong></p>

<p>Alright! Let&rsquo;s go through the possibility of the states.</p>

<p><strong>States 1 and 2</strong> are not only possible, they&rsquo;re intended. They&rsquo;re the only
allowable states if the program is to be 100% resilient to crashes. State 1 can
occur if the program crashes before opening the file. State 2 can occur if the
crash occurs after the close.</p>

<p><strong>State 3</strong> is possible. It can occur if the program crashes after the call to
<code>open</code> but before the <code>write</code> call is persisted to disk. Note that the
<code>O_TRUNC</code> flag truncates the file to zero length when the file is opened.</p>

<p><strong>State 4</strong> is not possible. The file <code>f</code> will always exist on disk in some form.</p>

<p><strong>State 5</strong> is possible. Writes are not atomic and can be batched up in arbitrary
sized chunks (although the size is usually much larger than a few bytes).</p>

<p><strong>State 6</strong> is a strange case, but surprisingly, possible! How does that
happen? It appears as though garbage data was appended to the file!</p>

<p>This disk state is possible because writes are sometimes executed as two
parallel operations.</p>

<ol>
<li>The data content is written.</li>
<li>The size of the file is updated.</li>
</ol>

<p>If a crash occurs at precisely the wrong time, the change to the file size may
be persisted to disk without the additional data being written.</p>

<p>This even happens in modern file systems such as <em>ext4</em> (although only in
writeback mode). So if you&rsquo;re the author of a program that writes to files and
you care about crash resilience, this is something you should design your
program around.</p>

<p>So how can we get around these problems? A common idiom is to create a
temporary file, write the new content to it, then rename it to the old file.
<strong>But&hellip;</strong></p>

<h2 id="what-could-go-wrong-when-you-rename-a-file">What could go wrong when you rename a file?</h2>

<pre><code>01 int fd = open(&quot;tmp&quot;, O_RDWR | O_CREAT | O_TRUNC, 0644);
02 write(fd, &quot;12345&quot;, 5);
03 close(fd);
04 rename(&quot;tmp&quot;, &quot;f&quot;);
</code></pre>

<p>There are some crash states where the
file <code>f</code> contains content other than <code>ABC</code> or <code>12345</code>. Below are the same set
crash states as before. Again, think about whether each crash
state is possible or not.</p>

<ol>
<li><code>f</code> contains <code>ABC</code>.</li>
<li><code>f</code> contains <code>12345</code>.</li>
<li><code>f</code> is now empty.</li>
<li><code>f</code> is missing from disk.</li>
<li><code>f</code> contains <code>123</code>.</li>
<li><code>f</code> contains <code>ABC$9</code>.</li>
</ol>

<p><strong>Pause for a moment to consider the possible states before reading on.</strong></p>

<p>Okay! Let&rsquo;s go through the different possibilities.</p>

<p><strong>States 1 and 2</strong> are still possible. That&rsquo;s good, it means we don&rsquo;t have a
regression.</p>

<p><strong>State 3</strong> is still possible. It can occur when <code>rename</code> on line 4 persists to
disk before the <code>write</code> on line 2 (and the crash occurs before the write
persists). The calls to <code>write</code> and <code>rename</code> are not guaranteed to persist in
order.</p>

<p>Notably, the <code>close</code> <em>doesn&rsquo;t force the file contents to be persisted to disk.</em>
There is a common misconception among programmers that closing a file flushes
to disk, but this is not true.  This is the behaviour for C as well as some
higher level languages such as <a href="https://golang.org/pkg/os/#File">Go</a> and
<a href="https://docs.python.org/2/library/stdtypes.html#file-objects">Python</a>.</p>

<p>From the <a href="https://linux.die.net/man/2/close">man page</a>:</p>

<p><em>A successful close does not guarantee that the data has been successfully saved
to disk, as the kernel defers writes. It is not common for a file system to
flush the buffers when the stream is closed. If you need to be sure that the
data is physically stored use fsync(2). (It will depend on the disk hardware at
this point.)</em></p>

<p><strong>State 4</strong> is not possible. This is because <code>rename</code> is atomic, so there will
never be a case where <code>f</code> is missing from disk.</p>

<p><strong>State 5</strong> is possible; after crashing the file may contain only <code>123</code>. The first
part of the <code>write</code> on line 2 could persist, then the file could be renamed. If
the crash occurs before the final part of the <code>write</code> persists, then <code>123</code> would
be the result.</p>

<p><strong>State 6</strong> could also occur. This is similar to state 5. The rename may be
persisted before the write. The write may only partially persist before the
crash, leaving the file size updated without the data being written.</p>

<p>Notice that the set of bad crash states is the same as before&hellip;  So in a
certain sense, the program has become more complicated but can still break in
the same ways. <em>Not to fear though,</em> with one small tweak we can fix everything!</p>

<p>We need one more system call to fix the program. Remember how <code>close</code> doesn&rsquo;t
flush the file content to disk? The man page gave an important hint, <code>fsync</code>!</p>

<h2 id="sync-as-a-solution">Sync as a solution</h2>

<p><code>fsync</code> flushes all pending <code>write</code>s through any buffers and persists them to
physical disk. It&rsquo;s a blocking call, and doesn&rsquo;t return until the data is
completely persisted.  There are equivalents in higher level languages. In Go
it&rsquo;s <a href="https://golang.org/pkg/os/#File.Sync">File.Sync</a>, and in Python it&rsquo;s
<a href="https://golang.org/pkg/os/#File.Sync">os.fsync</a>.</p>

<p>So how does it help? Let&rsquo;s alter the program again. It&rsquo;s the same as before,
except that we use <code>fsync</code> after the write.</p>

<pre><code>01 int fd = open(&quot;tmp&quot;, O_RDWR | O_CREAT | O_TRUNC, 0644);
02 write(fd, &quot;12345&quot;, 5);
03 fsync(fd);
04 close(fd);
05 rename(&quot;tmp&quot;, &quot;f&quot;);
</code></pre>

<p>Now we&rsquo;re getting somewhere! The temp file is created and has <code>12345</code> written
to it. The sync causes the data to be persisted to disk. Only then is the file
renamed. The file <code>f</code> cannot end up empty since the <code>write</code> now <em>has to</em>
persist before the <code>rename</code>. For the same reason, the file can&rsquo;t end up with
<code>123</code> or <code>ABC$9</code>. No matter how the program crashes, <code>f</code> will always either
contain <code>ABC</code> or <code>12345</code>. Neat!</p>

<h2 id="back-to-alice">Back to ALICE</h2>

<p>In simple programs like the ones above, it&rsquo;s <em>possible</em> to identify and fix
crash resilience problems manually, <em>so long as you understand all of the
limitations and guarantees that file systems provide</em>. For large programs like
<a href="https://github.com/dgraph-io/badger">Badger</a>, it&rsquo;s much more difficult.
Luckily, the process becomes easier with the aid of tooling.</p>

<p>ALICE is one such tool that can help find crash vulnerabilities. You still need
to understand the limitations and guarantees of the file system to use the
tool, but it <em>does</em> do most of the heavy lifting when it comes to the
identification of problems.</p>

<p><em>So how does it work?</em></p>

<p>ALICE works by executing a <em>workload</em> (supplied by the user). This starts up
the application-under-test and makes it perform various operations.  ALICE
records the system calls made by the program, including the details of all file
system manipulations.  Using the record of those system calls, it is able to
create all of the possible crash states that could occur. To do this, it takes
into consideration all of the legal reorderings of the file system
manipulations made by the program-under-test. For each crash states,
ALICE runs a <em>checker</em> (also supplied by the user).  The checker tests to see
if the crash state is permissible i.e. the program-under-test can start up,
recover from the crash, and continue from where it left off.</p>

<p>So what does this look like for the <code>ABC</code> -&gt; <code>12345</code> example?</p>

<p>The workload is just the program that changes the content of the file (we start
with the <em>incorrect</em> attempt at the program):</p>

<pre><code>int main()
{
    int fd = open(&quot;f&quot;, O_RDWR | O_TRUNC, 0666); // assert(fd &gt; 0);
    int ret = write(fd, &quot;12345&quot;, 5);            // assert(ret == 5);
    ret = close(fd);                            // assert(ret == 0);
}
</code></pre>

<p>What about the checker? It simply checks the consistency constraints that we
expect the program to maintain. It can be written in any language, e.g. Python:</p>

<pre><code>import os
import sys

crashed_state_directory = sys.argv[1]
os.chdir(crashed_state_directory)
assert open('f').read() in ['ABC', '12345']
</code></pre>

<p>When ALICE is run, its output indicates that there are some crash
vulnerabilities:</p>

<p><img src="https://blog.dgraph.io/images/alice_before_toy.png" alt="" /></p>

<p>The output indicates that there is a problem if the file is truncated, but
<em>not</em> appended to.</p>

<p>When we run the second version of the program, we get a different report from
ALICE.</p>

<pre><code>int main() {
    int fd = open(&quot;tmp&quot;, O_RDWR | O_CREAT | O_TRUNC, 0666); // assert(fd &gt; 0);
    int ret = write(fd, &quot;12345&quot;, 5); // assert(ret == 5);
    ret = close(fd);                 // assert(ret == 0);
    ret = rename(&quot;tmp&quot;, &quot;f&quot;);        // assert(ret == 0);
}

</code></pre>

<p><img src="https://blog.dgraph.io/images/alice_intermediate_toy.png" alt="" /></p>

<p>This time, ALICE indicates that the ordering of system calls is not guaranteed.
Specifically, the rename may persist before the append.</p>

<p>Once the problem with the program is fixed (the <code>fsync</code> call added), ALICE
reports that there are no errors:</p>

<pre><code>int main() {
    int fd = open(&quot;tmp&quot;, O_RDWR | O_CREAT | O_TRUNC, 0666); // assert(fd &gt; 0);
    int ret = write(fd, &quot;12345&quot;, 5); // assert(ret == 5);
    ret = fsync(fd);                 // assert(ret == 0);
    ret = close(fd);                 // assert(ret == 0);
    ret = rename(&quot;tmp&quot;, &quot;f&quot;);        // assert(ret == 0);
}
</code></pre>

<p><img src="https://blog.dgraph.io/images/alice_final_toy.png" alt="" /></p>

<p>Excellent! The program is now free of crash vulnerabilities.</p>

<p>As part of their
<a href="http://research.cs.wisc.edu/adsl/Publications/alice-osdi14.pdf">research</a>, the
authors of ALICE checked various key value stores and databases for crash
vulnerabilities. We decided to put
<a href="https://github.com/dgraph-io/badger">Badger</a> through the same paces. There
were two main motivations for this:</p>

<ul>
<li>To see how <a href="https://github.com/dgraph-io/badger">Badger</a> stacks up against
other existing key value stores.</li>
<li>To find (<em>and fix!</em>) any crash vulnerabilities in
<a href="https://github.com/dgraph-io/badger">Badger</a>.</li>
</ul>

<h2 id="testing-badger-with-alice">Testing Badger with ALICE</h2>

<p>The
<a href="https://github.com/dgraph-io/tove/blob/master/badger/workload/workload.go">workload</a>
and
<a href="https://github.com/dgraph-io/tove/blob/master/badger/checker/checker.go">checker</a>
are a little bit more complicated for
<a href="https://github.com/dgraph-io/badger">Badger</a>. The workload inserts some
key/value pairs, then updates them several times. The checker then ensures that
<a href="https://github.com/dgraph-io/badger">Badger</a> can start up after the simulated
crash.</p>

<p>In order to test as many code paths in
<a href="https://github.com/dgraph-io/badger">Badger</a> as possible, we needed the
workload to trigger both <em>LSM tree compaction</em> and a <em>value log garbage
collection</em>. LSM tree compactions are necessary to allow the high write
throughput possible with the design. Value log garbage collection rewrites
value log files to reclaim disk space, discarding stale entries in the process.</p>

<p>In order to coax <a href="https://github.com/dgraph-io/badger">Badger</a> into performing
both of the above, Badger&rsquo;s parameters <a href="https://github.com/dgraph-io/tove/blob/master/badger/util/util.go#L14-L26">are set
up</a>
so that it will aggressively trigger them, even for small data writes.</p>

<p>When ALICE was first run over <a href="https://github.com/dgraph-io/badger">Badger</a>,
the output indicated quite a few problems:</p>

<p><em>Triggering value log garbage collection:</em></p>

<p><img src="https://blog.dgraph.io/images/alice_before_badger.png" alt="" /></p>

<p><em>Triggering LSM tree compaction:</em></p>

<p><img src="https://blog.dgraph.io/images/alice_lsm_compaction_before.png" alt="" /></p>

<p>The long list of problems from the output only corresponds to two different
vulnerabilities, which are discussed in detail in the next sections.</p>

<p>To put <em>two crash vulnerabilities</em> into perspective, we can compare to the
number of vulnerabilities that were found by the ALICE authors in other
programs, as documented
<a href="http://research.cs.wisc.edu/adsl/Publications/alice-osdi14.pdf">in the paper</a>.</p>

<p><img src="https://blog.dgraph.io/images/crash_vulnerability_comparison.png" alt="comparison" /></p>

<p><a href="https://github.com/dgraph-io/badger">Badger</a> does considerably better than
some other database style applications, even those that are backed by large
organisations, e.g.:</p>

<ul>
<li>Google&rsquo;s Leveldb: 6 crash vulnerabilities.</li>
<li>GNU&rsquo;s GDBM: 5 crash vulnerabilities.</li>
<li>HSQLDB: 10 crash vulnerabilities.</li>
</ul>

<p>Another thing to note is that at Dgraph Labs, we&rsquo;re actively seeking out
resources to make our products the best that they can be. When you&rsquo;re writing
world class software, behaving reactively and waiting for the bug reports to
roll in, just isn&rsquo;t an option!</p>

<p>So what does the ALICE output mean, and how does it translate into actual crash
vulnerabilities?</p>

<h2 id="crash-vulnerability-1-garbage-writes">Crash Vulnerability #1 - Garbage Writes</h2>

<p>When <a href="https://github.com/dgraph-io/badger">Badger</a> appends to a value log file,
it just does a normal appending <code>write</code>. As seen previously, a crash during or
shortly after an append can result in the file containing some garbage data.</p>

<p>In the ALICE output:</p>

<p><img src="https://blog.dgraph.io/images/alice_vul1_trace.png" alt="" />
<img src="https://blog.dgraph.io/images/alice_vul1_vulns.png" alt="" /></p>

<p>ALICE is able to generate crash states containing garbage by artificially
injecting garbage bytes into the ends of the recorded writes.</p>

<p><em>This is a little bit confusing though.</em> Recall that this was a known problem
that was previously &lsquo;solved&rsquo; by adding a checksum to the end of each value log
entry. While replaying a value log, if an entry&rsquo;s checksum doesn&rsquo;t match up, we
assume that the value log is corrupted and truncate it. So why are garbage
writes causing crashes in <a href="https://github.com/dgraph-io/badger">Badger</a>? They
should just be discarded.</p>

<p>Unfortunately, ALICE doesn&rsquo;t give any clues. It doesn&rsquo;t show the output of the
checker, it just indicates that it failed.  I had to hack the ALICE source code
to leave the crash states on disk, rather than cleaning them up at the end of
its execution. I could then iterate over the crash states myself, manually
checking how <a href="https://github.com/dgraph-io/badger">Badger</a> reacts when it starts up.</p>

<p>Once I did this, it was obvious what the problem was. For some crash states,
<a href="https://github.com/dgraph-io/badger">Badger</a> terminated with an out of memory
error. The stack traces indicated the problem was occurring in the value log
replay code.</p>

<h4 id="vulnerability">Vulnerability</h4>

<p>The vulnerability occurs when the key and value lengths in a value log entry
header contain garbage data. These lengths are used to figure out how to read
the key and value. A 4-byte integer&rsquo;s largest value is ~4
billion, causing a worst case memory allocation of 8GB (4GB for each of the key
and value). This can cause the process to go out of memory, resulting in
<a href="https://github.com/dgraph-io/badger">Badger</a> refusing to start.</p>

<h4 id="solution">Solution</h4>

<p>Since we expect that keys will always be smaller than 1MB and values will
always be smaller than 1GB (these are generous bounds), we can simply cap the
allowable size of keys and values. If the header indicates that the key or
value is bigger than its bound, we know the entry is corrupt (and avoid a
memory allocation based on bad data). But what if the header is corrupt but
the key and value lengths are within their bounds? In that case, we can still
detect the corruption using the checksum.</p>

<p>Once a corrupt entry is detected, we can truncate the value log at that point.</p>

<p>The relevant pull request is
<a href="https://github.com/dgraph-io/badger/pull/158">here</a>.</p>

<h2 id="crash-vulnerability-2">Crash Vulnerability #2</h2>

<p>The value log is actually made up of many smaller <em>value log files</em>.  When an
individual value log file gets too big, a new one is created. The value log
(conceptually the concatenation of all of the value log files) then continues
in the new value log file. Meanwhile,
<a href="https://github.com/dgraph-io/badger">Badger</a> maintains a head pointer,
corresponding to the offset in value log, uptil which everything has been
persisted to disk on the LSM tree.</p>

<p>When <a href="https://github.com/dgraph-io/badger">Badger</a> starts up, it picks the
latest value of head from the persisted portion of the LSM tree, and replays
the entries from value log from that offset onwards to bring them back into LSM
tree (for more details about how this works, see <a href="https://www.usenix.org/system/files/conference/fast16/fast16-papers-lu.pdf">the original
paper</a>).</p>

<p>The ALICE output indicates that there is a problem around the transition from
one value log file (<code>*.vlog</code>) to the next:</p>

<p><img src="https://blog.dgraph.io/images/alice_vul2_trace.png" alt="" />
<img src="https://blog.dgraph.io/images/alice_vul2_vulns.png" alt="" /></p>

<h5 id="vulnerability-1">Vulnerability</h5>

<p>When <a href="https://github.com/dgraph-io/badger">Badger</a> starts up, all of the
<code>*vlog</code> are first opened:</p>

<ul>
<li>The latest <code>vlog</code> file is opened in read/write mode. This is the <code>vlog</code> file
that will be appended to when the key value store is mutated.</li>
<li>All previous <code>vlog</code> files are opened in read-only mode. They are only used
for value lookups.</li>
</ul>

<p>The value log is then replayed from the head persisted in the LSM tree.  When a
corrupt entry in a <code>vlog</code> file is found during replay, that file is truncated
so that it contains only good entries. This is normally fine, because the
corrupt file is expected to be the latest one (since it would have been
appended to last before the crash).</p>

<p><em>This isn&rsquo;t always the case though&hellip;</em></p>

<p>The problem occurs when the content of <code>000001.vlog</code> is persisted to disk
before the content of <code>000000.vlog</code>. <code>000001.vlog</code> will be the latest value log
file (opened as read/write), but <code>000000.vlog</code> (opened as read-only) may have
corrupt entries. The result is that we try to truncate a file that is opened in
read-only mode.</p>

<p>This vulnerability only occurs when
<a href="https://github.com/dgraph-io/badger">Badger</a> is configured with
<code>SyncWrites=false</code>. This is a mode that trades off increased write performance
for the chance that if <a href="https://github.com/dgraph-io/badger">Badger</a> crashes,
some small amount of recently written data may be lost. However, the
vulnerability <em>does</em> leave <a href="https://github.com/dgraph-io/badger">Badger</a> unable
to restart which is unacceptable.</p>

<h5 id="solution-1">Solution</h5>

<p>There are a few different possible fixes here. We went for a simple fix: always
<a href="https://github.com/dgraph-io/badger/pull/157">sync the current <code>vlog</code> file before starting a new
one</a>. That way, the nth value log
file is always persisted completely before the n+1th is written.</p>

<h2 id="concluding-thoughts">Concluding thoughts</h2>

<p>After we fixed the problems that ALICE reported, running ALICE again shows no
crash vulnerabilities for <a href="https://github.com/dgraph-io/badger">Badger</a>. Awesome!</p>

<p><em>Triggering value log garbage collection:</em></p>

<p><img src="https://blog.dgraph.io/images/alice_after_badger.png" alt="" /></p>

<p><em>Triggering LSM tree compaction:</em></p>

<p><img src="https://blog.dgraph.io/images/alice_lsm_compaction_after.png" alt="" /></p>

<p><strong>Here at Dgraph Labs, we really care about making our products as robust as
possible,</strong> even under unlikely and rare scenarios such as system crashes.
We want to stay ahead of the curve when it comes to rock solid
stability. Proactively finding and fixing bugs before they are reported in
production is a major part of that.</p>

<p>If you own and maintain software that interacts directly with files, we
recommend that you give ALICE a try. Also, if you need a rock solid and
performant key-value store, you know <a href="https://github.com/dgraph-io/badger">where to
look</a>!</p>

<p><img src="https://blog.dgraph.io/images/jumping_badger.jpg" alt="Happy Badger" /></p>



<aside class="post__references">

    <h4>References</h4><p>Top image: <a href="https://fineartamerica.com/featured/galileo-spacecraft-burning-up-in-jupiter-christian-darkin.html">Galileo Spacecraft Burning Up In
Jupiter</a></p>
</aside>


                     
    <aside class="post__authors">
                <div class="tile author-tile">

    <img src="https://blog.dgraph.io/images/people/peter.jpg" class="author-tile__photo">

    <h4 class="author-tile__title">
        <a href="https://blog.dgraph.io/authors/peter/">Peter Stace</a>,
        Author
    </h4>

    <p>After Peter graduated in Computer Science in 2012, he worked on low latency
derivative trading systems. He enjoys optimising systems for efficiency and
speed. In his spare time, he enjoys cycling and drone racing.</p>


    
        <nav class="author-tile__social">

            
                <a href="https://www.linkedin.com/in/peter-stace-b34726b8/" target="_blank">
                    <i class="fab fa-linkedin"></i>
                </a>
            

            
                <a href="https://twitter.com/peterjohnstace" target="_blank">
                    <i class="fab fa-twitter"></i>
                </a>
            

            
                <a href="https://github.com/peterstace" target="_blank">
                    <i class="fab fa-github"></i>
                </a>
            

        </nav>
    

</div>

            
        
                <div class="tile author-tile">

    <img src="https://blog.dgraph.io/images/people/manish.jpg" class="author-tile__photo">

    <h4 class="author-tile__title">
        <a href="https://blog.dgraph.io/authors/mrjn/">Manish Rai Jain</a>,
        Editor
    </h4>

    <p>Manish is the Chief decision maker at Dgraph. He got thrust into distributed
systems right out of college, working on real time web indexing systems at
Google. He then lead various projects to consolidate and serve Knowledge Graph
right behind web search.</p>

<p>Implementing GTD and Zero Waste practices, Manish is into efficient and
minimalist living. He loves cycling, swimming and ultra light travelling.</p>


    
        <nav class="author-tile__social">

            

            
                <a href="https://twitter.com/manishrjain" target="_blank">
                    <i class="fab fa-twitter"></i>
                </a>
            

            
                <a href="https://github.com/manishrjain" target="_blank">
                    <i class="fab fa-github"></i>
                </a>
            

        </nav>
    

</div>

            
        

    </aside>


                     <div class="  text-center subscribe-box">
    

    <h3>Get blog post to <br/>your inbox</h3>
    

<div id="mc_embed_signup">
<form action="https://dgraph.us17.list-manage.com/subscribe/post?u=f6c6a28bb40d10e26b88fff1c&amp;id=e85c448cac" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
	
<div class="mc-field-group">
	
	<input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="your Email">
</div>
	<div id="mce-responses" class="clear">
		<div class="response" id="mce-error-response" style="display:none"></div>
		<div class="response" id="mce-success-response" style="display:none"></div>
	</div>    
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_f6c6a28bb40d10e26b88fff1c_e85c448cac" tabindex="-1" value=""></div>
    <div class="clear"><button type="submit"  name="subscribe" id="mc-embedded-subscribe" class="button button--secondary mt-2"><span>Subscribe</span><i class="fas fa-arrow-right"></i></button></div>
    </div>
</form>
</div>
<script type='text/javascript' src='//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script><script type='text/javascript'>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
<div class="d-flex align-items-center justify-content-center mt-4">
    <a href="https://github.com/dgraph-io/dgraph" target="_blank" ><i class="fa fa-github px-3"></i></a>
    <a href="https://slack.dgraph.io/" target="_blank"  ><i class="fa fa-slack px-3"></i></a>
    <a href="https://discuss.dgraph.io/" target="_blank"  ><i class="fa fa-comments px-3"></i></a>
</div>
<div class="close position-absolute d-block d-lg-none"><i class="fa fa-close"></i></div>

</div>

<div class="subscribe-box-mobi">
    <div class="d-flex align-items-center justify-content-center  flex-column">
        <a href="https://github.com/dgraph-io/dgraph" target="_blank" ><i class="fa fa-github py-3"></i></a>
        <a href="https://slack.dgraph.io/" target="_blank"  ><i class="fa fa-slack py-3"></i></a>
        <a href="https://discuss.dgraph.io/" target="_blank"  ><i class="fa fa-comments py-3"></i></a>
        <div class="click-btn"><i class="fa fa-envelope-o py-3"></i></div>

    </div>

</div>

                  </div>
               </div>
            </div>
         </div>
      </div>
      </div>
   </section>
   <div class='bottom-section'>
      <div class="container">
         <div class="post__content inner-content lg-pl-80 lg-pr-80 md-pl-50 md-pr-50 xs-pl-30 xs-pr-30 clearfix">
            <div class="post__comments">

    <div id="discourse-comments"></div>

    
    <script type="text/javascript">
        DiscourseEmbed = {
            discourseUrl: "https:\/\/discuss.dgraph.io\/",
            topicId:  1685 
            };
        (function() {
            var d = document.createElement("script");
            d.type = "text/javascript";
            d.async = true;
            d.src = DiscourseEmbed.discourseUrl + "javascripts/embed.js";
            (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(d);
        })();
    </script>
    <noscript>Please enable JavaScript to view the comments on <a href="https://discuss.dgraph.io/">discuss</a>.</noscript>
    

</div>

            <div class="modal fade" id="runnable-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <a href="#" data-dismiss="modal" class="modal-close-btn">
    Close
  </a>

  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-body">

      </div>
    </div>
  </div>
</div>
        </div>
        <div class="mx-auto" style="max-width:860px">

         <div
            class=" bg-gray xs-pt-60 xs-pb-60 round text-center md-pl-80 md-pr-80 own-success-story xs-mb-80  xs-mt-80 lg-ml-80 lg-mr-80 md-ml-50 md-mr-50 xs-ml-30 xs-mr-30 " >
            <p>Create you own success story.</p>
            <h2 class="font-medium">Interpret, store, distribute and execute GraphQL with the best.</h2>
            <div class="xs-mt-50 d-flex align-items-center justify-content-center flex-column flex-md-row">
               <a href="https://dgraph.io/downloads" class="button button--primary mr-0 mr-md-3"><span>Get
               Started</span> <i class="fas fa-arrow-right"></i></a>
               <a class="button  button--outline" target="_blank"
                  href="https://github.com/dgraph-io/dgraph"><span>View<span> on Github</span></span><i
                  class="fas fa-arrow-right"></i></a>
            </div>
        </div>

         </div>
         <div class="page-body__related-content mb-4">
            




<h3 class=" font-22 pb-4">But wait, there’s more...</h3>

<div class=" row justify-content-center mt-4">


    
    <div class="post col-sm-4">

        <div class="post__image">
    <img src="https://blog.dgraph.io//images/when_neutron_stars_collide.jpg">
</div>


    	<div class="post__header">

    		<div class="post__date">

    
        Tue, Nov 14, 2017
    
    
</div>


    		<h4 class="post__title">
    			<a href="https://blog.dgraph.io/post/v0.9/">Releasing distributed transactions in v0.9</a>
    		</h4>

    		
<div class="post__byline">

    
            by <a href="https://blog.dgraph.io/authors/peter/">Peter Stace</a>
        
    

</div>



    	</div>

    </div>
    
    <div class="post col-sm-4">

        <div class="post__image">
    <img src="https://blog.dgraph.io//images/cassini.jpg">
</div>


    	<div class="post__header">

    		<div class="post__date">

    
        Mon, Oct 9, 2017
    
    
</div>


    		<h4 class="post__title">
    			<a href="https://blog.dgraph.io/post/bulkloader/">Loading close to 1M edges/sec into Dgraph</a>
    		</h4>

    		
<div class="post__byline">

    
            by <a href="https://blog.dgraph.io/authors/peter/">Peter Stace</a>
        
    

</div>



    	</div>

    </div>
    

</div>



            

         </div>
      </div>
      <footer class="page-footer">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-5 col-sm-4">
        <div class="row">
          <div class="col-12 col-md-6 page-footer__nav">
            <h3 class="zeta">Products</h3>
            <ul>
              <li><a href="https://dgraph.io/graphql">GraphQL</a></li>
              <li><a href="https://dgraph.io/enterprise">Enterprise</a></li>
              <li><a href="https://dgraph.io/downloads">Downloads</a></li>
            </ul>
          </div>
          <div class="col-12 col-md-6 page-footer__nav">
            <h3 class="zeta">Learn</h3>
            <ul>
              <li><a href="https://dgraph.io/blog" target="_blank">Blog</a></li>
              <li><a href="https://tour.dgraph.io" target="_blank">Interactive Tour</a></li>
              <li><a href="https://discuss.dgraph.io" target="_blank">Forum</a></li>
              <li><a href="https://slack.dgraph.io" target="_blank">Slack</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-5 col-sm-4">
        <div class="row">
          <div class="col-12 col-md-6 page-footer__nav">
            <h3 class="zeta">Docs</h3>
            <ul>
              <li><a href="https://docs.dgraph.io" target="_blank">Dgraph Docs</a></li>
              <li><a href="https://graphql.dgraph.io/docs/" target="_blank">GraphQL Docs</a></li>
            </ul>
          </div>
          <div class="col-12 col-md-6 page-footer__nav">
            <h3 class="zeta">Company</h3>
            <ul>
              <li><a href="https://dgraph.io/about">Team</a></li>
              <li><a href="https://dgraph.io/careers">Careers</a></li>
              <li><a href="https://dgraph.io/contact">Contact</a></li>
              <li><a href="https://dgraph.io/conduct">Conduct</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-12 col-sm-6 col-md-4 col-lg-3 offset-lg-1 border-above-sm">
        <div class="page-footer__cta"><a href="https://dgraph.io/downloads" title="Download" class="button button--secondary"><span>Download</span><i class="fas fa-arrow-right"></i></a></div>
        <div class="page-footer__address">
          <p>
            655 Montgomery Street, 7th Floor<br>
            San Francisco, CA 94111
          </p>
          <hr>
          <p><a href="mailto:contact@dgraph.io">contact@dgraph.io</a></p>
        </div>
      </div>
    </div>
    <div class="page-footer__social">
      <ul>
        <li><a href="https://twitter.com/dgraphlabs" target="_blank"><i class="fab fa-twitter"></i></a></li>
        <li><a href="https://github.com/dgraph-io/dgraph" target="_blank"><i class="fab fa-github"></i></a></li>
        <li><a href="https://www.youtube.com/channel/UCghE41LR8nkKFlR3IFTRO4w" target="_blank"><i class="fab fa-youtube"></i></a></li>
        <li><a href="https://slack.dgraph.io" target="_blank"><i class="fab fa-slack"></i></a></li>
        <li><a href="https://www.linkedin.com/company/dgraph-labs" target="_blank"><i class="fab fa-linkedin"></i></a></li>
      </ul>
    </div>
    <div class="page-footer__copyright">
      <p>
        <Copyright>&copy; 2017-2020 Dgraph Labs, Inc.</Copyright>
      </p>
    </div>
  </div>
</footer>

    <script src="https://blog.dgraph.io//js/clipboard.min.js"></script>
    <script
      src='https://blog.dgraph.io//js/runnable.js?29f8ba4fb8d90804cf24ff53b70192ad'
    ></script>
    <script>
      hljs.initHighlightingOnLoad();
    </script>




<script>
  window.Countly = window.Countly || {};
  Countly.q = Countly.q || [];

  Countly.q.push(['track_sessions']);
  Countly.q.push(['track_pageview']);
  (function() {
  	var cly = document.createElement('script');
  	cly.type = 'text/javascript';
  	cly.async = true;
  	cly.src = "https://dgraph.io/assets/js/unminified/stats/dgraph-stats.min.js";
  	cly.onload = function() {
      Countly.init({
        app_key: "e93284ab5e5d21ef9eb16a94516b3c1c6eba1015",
        url: "https://stats.dgraph.io",
        force_post: true,
      })
  	};
  	document.body.appendChild(cly);
  })();
</script>


<script>
$(document.links)
  .filter(function() {
    return this.hostname != window.location.hostname;
  })
  .attr("target", "_blank");
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/visibility.js/1.2.4/visibility.min.js"></script>
<link href="https://fonts.googleapis.com/css?family=Indie+Flower" rel="stylesheet">
<link
  href='https://blog.dgraph.io//css/heart.css?24a50879951b2391f04750723b4a012e'
  rel="stylesheet">
<link
  href='https://blog.dgraph.io//css/github-engage.css?d60d80bf2b6a24350cdb5d834ab47e27'
  rel="stylesheet">

<script
  src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.min.js"
  integrity="sha256-7/yoZS3548fXSRXqc/xYzjsmuW3sFKzuvOCHd06Pmps="
  crossorigin="anonymous"
></script>
<script
  type="text/javascript"
  src='https://blog.dgraph.io//js/custom.js?94f0c667422b8dac293e14c9c49872e3'
></script>

<script src="//unpkg.com/@dgraph-io/community"></script>

   </div>
</body>
    <script src="https://blog.dgraph.io/js/footnotes.js"></script>

</html>
